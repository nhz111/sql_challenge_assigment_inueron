
create table city(ID int, NAME varchar(17),COUNTRYCODE varchar(3),DISTRICT varchar(20),POPULATION int);

insert into city values(6,'Rotterdam','NLD','Zuid-Holland',null),

insert into city values(19,'Zaanstad','NLD','Noord Holland',135621);

insert into city values(214,'Porto Alegre','BRA','Rio Grande do Sul',1314032);

insert into city values(397,'Lauro de Freitas','BRA','Bahia',109236);

insert into city values(547,'Dobric','BGR','Varna',100399);

insert into city values(552,'Bujumbura','BDI','Bujumbura',300000);

insert into city values(554,'Santiago de Chile','CHL', 'Santiago',4703954);

insert into city values(626,'al-Minya','EGY','al-Minya',201360);

insert into city values(646,'Santa Ana',	'SLV',	'Santa Ana',139389);

insert into city values(762,'Bahir','Dar',	'ETH Amhara',	96140);

insert into city values(796,'Baguio',	'PHL',	'CAR'	,252386);

insert into city values(896,'Malungon',	'PHL',	'Southern Mindanao',93232);

insert into city values(904,'Banjul',	'GMB',	'Banjul',	42326);

insert into city values(924,'Villa','GTM','Nueva',101295);

insert into city values(990,'Waru','IDN','East Java',124300);

insert into city values(1155,'Latur',	'IND',	'Maharashtra',	197408);

insert into city values(1222,'Tenali',	'IND',	'Andhra Pradesh',	143726);

insert into city values(1235,'Tirunelveli','IND','Tamil Nadu',	135825);

insert into city values(1256,'Alandur','IND','Tamil Nadu',	125244);

insert into city values(1279,'Neyveli','IND','Tamil Nadu',	118080);

insert into city values(1293,'Pallavaram','IND','Tamil Nadu',111866);

insert into city values(1350,'dehri','IND','Bihar',94526);

insert into city values(1383,'Tabriz',	'IRN','East Azerbaidzan',1191043);

insert into city values(1385,'Karaj','IRN',	'Teheran',940968);

insert into city values(1508,'Bolzano','ITA','Trentino-Alto Adige',97232);

insert into city values(1520,'Cesena','ITA','Emilia-Romagna',89852);

insert into city values(1613,'Neyagawa','JPN','Osaka',257315);

insert into city values(1630,'Ageo','JPN','Saitama',209442);

insert into city values(1661,'Sayama','JPN','Saitama',162472);

insert into city values(1681,'Omuta','JPN','Fukuoka',142889);

insert into city values(1739,'Tokuyama','JPN','Yamaguchi',107078);

insert into city values(1793,'Novi Sad','YUG','Vojvodina',179626);

insert into city values(1857,'Kelowna','CAN','British Colombia',89442);

insert into city values(1895,'Harbin','CHN','Heilongjiang',4289800);

insert into city values(1900,'Changchun',	'CHN','Jilin',2812000);

insert into city values(1913,'Lanzhou',	'CHN','Gansu',1565800);

insert into city values(1947,'Changzhou',	'CHN','Jiangsu',530000);

insert into city values(2070,'Dezhou','CHN','Shandong',195485);

insert into city values(2081,'Heze','CHN','Shandong',189293);

insert into city values(2111,'Chenzhou','CHN','Hunan',169400);

insert into city values(2153,'Xianning','CHN','Hubei',136811);

insert into city values(2192,'Lhasa','CHN','Tibet',120000);

insert into city values(2193,'Lianyuan','CHN','Hunan',118858);

insert into city values(2227,'Xingcheng','CHN','Liaoning',102384);

insert into city values(2273,'Villavicencio','COL','Meta',273140);

insert into city values(2384,'Tong-yong','KOR','Kyongsangnam',131717);

insert into city values(2386,'Yongju',	'KOR','Kyongsangbuk',131097);

insert into city values(2387,'Chinhae','KOR','Kyongsangnam',125997);

insert into city values(2388,'Sangju','KOR','Kyongsangbuk',124116);

insert into city values(2406,'Herakleion',	'GRC',	'Crete',116178);

insert into city values(2440,'Monrovia','LBR',	'Montserrado',850000);

insert into city values(2462,'Lilongwe','MWI','Lilongwe',	435964);

insert into city values(2505,'Taza','MAR','Taza-Al','Hoceima-Taou',92700);

insert into city values(2555,'Xalapa','MEX','Veracruz',390058);

insert into city values(2602,'Ocosingo','MEX','Chiapas',171495);

insert into city values(2609,'Nogales','MEX','Sonora',159103);

insert into city values(2670,'San Pedro','Cholula','MEX','Puebla',99734);

insert into city values(2689,'Palikir','FSM','Pohnpei',8600);

insert into city values(2706,'Tete','MOZ','Tete',101984);

insert into city values(2716,'Sittwe (Akyab)','MMR','Rakhine',137600);

insert into city values(2922,'Carolina','PRI','Carolina',186076);

insert into city values(2967,'Grudziadz', 'POL',	'Kujawsko-Pomorskie',	102434);

insert into city values(2972,'Malabo',	'GNQ',	'Bioko',40000);

insert into city values(3073,'Essen','DEU','Nordrhein-Westfalen',599515);

insert into city values(3169,'Apia','WSM','Upolu',35900);

insert into city values(3198,'Dakar','SEN','Cap-Vert',785071);

insert into city values(3253,'Hama','SYR','Hama',343361);

insert into city values(3288,'Luchou','TWN','Taipei',160516);

insert into city values(3309,'Tanga','TZA','Tanga',137400);

insert into city values(3353,'Sousse','TUN','Sousse',145900);

insert into city values(3377,'Kahramanmaras','TUR','Kahramanmaras',245772);

insert into city values(3430,'Odesa','UKR','Odesa',1011000);

insert into city values(3581,'St Petersburg','RUS','Pietari',4694000);

insert into city values(3770,'Hanoi','VNM','Hanoi',1410000);

insert into city values(3815,'El Paso','USA','Texas',563662);

insert into city values(3878,'Scottsdale','USA','Arizona',202705);

insert into city values(3965,'Corona','USA','California',124966);

insert into city values(3973,'Concord','USA','California',121780);

insert into city values(3977,'Cedar Rapids','USA','Iowa',120758);

insert into city values(3982,'Coral Springs','USA','Florida',117549);

insert into city values(4054,'Fairfield','USA','California',92256);

insert into city values(4058,'Boulder','USA','Colorado',91238);

insert into city values(4061,'Fall River','USA','Massachusetts',90555);




  1) select * from city where countrycode='usa' where population >100000;

  2) select name from city where countrycode='usa' where population >120000;

  3) select * from city;

  4) select * from city where id=1661;

1) select * from city where countrycode='usa' where population >100000;

+------+---------------+-------------+------------+------------+
| ID   | NAME          | COUNTRYCODE | DISTRICT   | POPULATION |
+------+---------------+-------------+------------+------------+
| 3815 | El Paso       | USA         | Texas      |     563662 |
| 3878 | Scottsdale    | USA         | Arizona    |     202705 |
| 3965 | Corona        | USA         | California |     124966 |
| 3977 | Cedar Rapids  | USA         | Iowa       |     120758 |
| 3982 | Coral Springs | USA         | Florida    |     117549 |
| 3973 | Concord       | USA         | California |     121780 |
+------+---------------+-------------+------------+------------+

2) select name from city where countrycode='usa' where population >120000;

--------------+
| name         |
+--------------+
| El Paso      |
| Scottsdale   |
| Corona       |
| Cedar Rapids |
| Concord      |
+--------------+

3) select * from city;

4) select * from city where id=1661;

+------+--------+-------------+----------+------------+
| ID   | NAME   | COUNTRYCODE | DISTRICT | POPULATION |
+------+--------+-------------+----------+------------+
| 1661 | Sayama | JPN         | Saitama  |     162472 |
+------+--------+-------------+----------+------------+

5)select * from city where countrycode='jpn';

+------+----------+-------------+-----------+------------+
| ID   | NAME     | COUNTRYCODE | DISTRICT  | POPULATION |
+------+----------+-------------+-----------+------------+
| 1613 | Neyagawa | JPN         | Osaka     |     257315 |
| 1630 | Ageo     | JPN         | Saitama   |     209442 |
| 1661 | Sayama   | JPN         | Saitama   |     162472 |
| 1681 | Omuta    | JPN         | Fukuoka   |     142889 |
| 1739 | Tokuyama | JPN         | Yamaguchi |     107078 |
+------+----------+-------------+-----------+------------+

6) select name from city where countrycode='jpn';

+----------+
| name     |
+----------+
| Neyagawa |
| Ageo     |
| Sayama   |
| Omuta    |
| Tokuyama |
+----------+


create table station(id int, city varchar(21), state varchar(2),LAT_N number, LAT_


insert into station values(794, 'Kissee Mills', 'MO', 139, 73),
                          (824, 'Loma Mar', 'CA', 48, 130),
						(603 ,'Sandy Hook', 'CT', 72, 148),
						(478 ,'Tipton', 'IN', 33, 97),
						(619 ,'Arlington', 'CO', 75, 92),
						(711 ,'Turner', 'AR', 50, 101),
						(839, 'Slidell', 'LA', 85, 151),
						(411 ,'Negreet', 'LA', 98, 105),
						(588 ,'Glencoe','KY', 46, 136),
						(665, 'Chelsea', 'IA', 98, 59),
						(342, 'Chignik Lagoon', 'AK', 103, 153),
						(733, 'Pelahatchie', 'MS', 38,28),
						(441, 'Hanna City', 'IL', 50, 136),
						(811,'Dorrance', 'KS', 102, 121),
						(698, 'Albany', 'CA', 49, 800),
						(325, 'Monument', 'KS', 70, 141),
						(414, 'Manchester', 'MD', 73, 37),
						(113, 'Prescott', 'IA', 39, 65),
						(971, 'Graettinger', 'IA', 94, 150),
						(266, 'Cahone', 'CO', 116, 127);
						
	mysql> select * from station;
+------+----------------+-------+-------+-------+
| id   | city           | state | Lat_N | Lat_W |
+------+----------------+-------+-------+-------+
|  794 | Kissee Mills   | MO    |   139 |    73 |
|  824 | Loma Mar       | CA    |    48 |   130 |
|  603 | Sandy Hook     | CT    |    72 |   148 |
|  478 | Tipton         | IN    |    33 |    97 |
|  619 | Arlington      | CO    |    75 |    92 |
|  711 | Turner         | AR    |    50 |   101 |
|  839 | Slidell        | LA    |    85 |   151 |
|  411 | Negreet        | LA    |    98 |   105 |
|  588 | Glencoe        | KY    |    46 |   136 |
|  665 | Chelsea        | IA    |    98 |    59 |
|  342 | Chignik Lagoon | AK    |   103 |   153 |
|  733 | Pelahatchie    | MS    |    38 |    28 |
|  441 | Hanna City     | IL    |    50 |   136 |
|  811 | Dorrance       | KS    |   102 |   121 |
|  698 | Albany         | CA    |    49 |   800 |
|  325 | Monument       | KS    |    70 |   141 |
|  414 | Manchester     | MD    |    73 |    37 |
|  113 | Prescott       | IA    |    39 |    65 |
|  971 | Graettinger    | IA    |    94 |   150 |
|  266 | Cahone         | CO    |   116 |   127 |
+------+----------------+-------+-------+-------+
20 rows in set (0.00 sec)


******************************************************************* question 7 **********************************************************************

  ans    > select city, state from station;
  
+----------------+-------+
| city           | state |
+----------------+-------+
| Kissee Mills   | MO    |
| Loma Mar       | CA    |
| Sandy Hook     | CT    |
| Tipton         | IN    |
| Arlington      | CO    |
| Turner         | AR    |
| Slidell        | LA    |
| Negreet        | LA    |
| Glencoe        | KY    |
| Chelsea        | IA    |
| Chignik Lagoon | AK    |
| Pelahatchie    | MS    |
| Hanna City     | IL    |
| Dorrance       | KS    |
| Albany         | CA    |
| Monument       | KS    |
| Manchester     | MD    |
| Prescott       | IA    |
| Graettinger    | IA    |
| Cahone         | CO    |
+----------------+-------+
20 rows in set (0.00 sec)

*********************************************************************** question 8 **********************************************************************


mysql> select distinct city from station
    -> where id%2=0;
+----------------+
| city           |
+----------------+
| Kissee Mills   |
| Loma Mar       |
| Tipton         |
| Glencoe        |
| Chignik Lagoon |
| Albany         |
| Manchester     |
| Cahone         |
+----------------+
8 rows in set (0.03 sec)

******************************************************************************* question 9 ********************************************************************************

select (count(city) - count(distinct city)) as difference

    -> from station;
+------------+
| difference |
+------------+
|          0 |
+------------+
1 row in set (0.02 sec)

********************************************************************************* question 10 ***************************************************************************

select city, length(city) from station order by length(city) desc, city limit 1;

+----------------+--------------+
| city           | length(city) |
+----------------+--------------+
| Chignik Lagoon |           14 |
+----------------+--------------+
1 row in set (0.01 sec)


select city, length(city) from station order by length(city) asc, city limit 1;
+--------+--------------+
| city   | length(city) |
+--------+--------------+
| Albany |            6 |
+--------+--------------+
1 row in set (0.01 sec)


******************************************************************************** question 11 ****************************************************************************8

 select distinct city from station where substring(city,1,1) in ('a', 'e','i','o','u');
+-----------+
| city      |
+-----------+
| Arlington |
| Albany    |
+-----------+
2 rows in set (0.02 sec)


SELECT * from STATION where FIND_IN_SET(left(CITY,1),'A,E,I,O,U')>0;
+------+-----------+-------+-------+-------+
| id   | city      | state | Lat_N | Lat_W |
+------+-----------+-------+-------+-------+
|  619 | Arlington | CO    |    75 |    92 |
|  698 | Albany    | CA    |    49 |   800 |
+------+-----------+-------+-------+-------+


*********************************************************************** quetion 12 ******************************************************

select city from station where right(city,1) in('a','e','i','o','u');
+-------------+
| city        |
+-------------+
| Glencoe     |
| Chelsea     |
| Pelahatchie |
| Dorrance    |
| Cahone      |
+-------------+


SELECT DISTINCT city FROM station WHERE city REGEXP '[aeiou]$';
+-------------+
| city        |
+-------------+
| Glencoe     |
| Chelsea     |
| Pelahatchie |
| Dorrance    |
| Cahone      |
+-------------+
5 rows in set (0.00 sec)

SELECT * from STATION where FIND_IN_SET(right(CITY,1),'A,E,I,O,U')>0;



SELECT * from STATION where FIND_IN_SET(right(CITY,1),'A,E,I,O,U')>0;
 
+------+-------------+-------+-------+-------+
| id   | city        | state | Lat_N | Lat_W |
+------+-------------+-------+-------+-------+
|  588 | Glencoe     | KY    |    46 |   136 |
|  665 | Chelsea     | IA    |    98 |    59 |
|  733 | Pelahatchie | MS    |    38 |    28 |
|  811 | Dorrance    | KS    |   102 |   121 |
|  266 | Cahone      | CO    |   116 |   127 |
+------+-------------+-------+-------+-------+
5 rows in set (0.00 sec)

********************************************************************************************** question 13 ************************************************************

mysql> SELECT DISTINCT city FROM station WHERE city NOT LIKE '[AEIOU]%' AND city NOT LIKE '%[aeiou]';
+----------------+
| city           |
+----------------+
| Kissee Mills   |
| Loma Mar       |
| Sandy Hook     |
| Tipton         |
| Arlington      |
| Turner         |
| Slidell        |
| Negreet        |
| Glencoe        |
| Chelsea        |
| Chignik Lagoon |
| Pelahatchie    |
| Hanna City     |
| Dorrance       |
| Albany         |
| Monument       |
| Manchester     |
| Prescott       |
| Graettinger    |
| Cahone         |
+----------------+
20 rows in set (0.01 sec)
******************************************************************************************** question 14 ************************************************************************

mysql> SELECT DISTINCT city
    -> FROM station
    -> WHERE city NOT RLIKE  '[aeiou]$';
	
+----------------+
| city           |
+----------------+
| Kissee Mills   |
| Loma Mar       |
| Sandy Hook     |
| Tipton         |
| Arlington      |
| Turner         |
| Slidell        |
| Negreet        |
| Chignik Lagoon |
| Hanna City     |
| Albany         |
| Monument       |
| Manchester     |
| Prescott       |
| Graettinger    |
+----------------+
15 rows in set (0.00 sec)


********************************************************************************************* questin 15 ****************************************************************************

mysql> SELECT DISTINCT CITY
    -> FROM STATION
    -> WHERE CITY NOT LIKE '[AEIOU]%' OR CITY NOT LIKE '%[aeiou]';
+----------------+
| CITY           |
+----------------+
| Kissee Mills   |
| Loma Mar       |
| Sandy Hook     |
| Tipton         |
| Arlington      |
| Turner         |
| Slidell        |
| Negreet        |
| Glencoe        |
| Chelsea        |
| Chignik Lagoon |
| Pelahatchie    |
| Hanna City     |
| Dorrance       |
| Albany         |
| Monument       |
| Manchester     |
| Prescott       |
| Graettinger    |
| Cahone         |
+----------------+
20 rows in set (0.00 sec)

mysql> SELECT DISTINCT CITY
    -> FROM STATION
    -> WHERE (CITY NOT IN (SELECT DISTINCT CITY FROM STATION WHERE CITY LIKE '%a' OR CITY LIKE '%e' OR CITY LIKE '%i' OR CITY LIKE '%o' OR CITY LIKE '%u'))
    -> OR
    -> (CITY NOT IN (SELECT CITY FROM STATION WHERE CITY LIKE 'A%' OR CITY LIKE 'E%' OR CITY LIKE 'I%' OR CITY LIKE 'O%' OR CITY LIKE 'U%'));
+----------------+
| CITY           |
+----------------+
| Kissee Mills   |
| Loma Mar       |
| Sandy Hook     |
| Tipton         |
| Arlington      |
| Turner         |
| Slidell        |
| Negreet        |
| Glencoe        |
| Chelsea        |
| Chignik Lagoon |
| Pelahatchie    |
| Hanna City     |
| Dorrance       |
| Albany         |
| Monument       |
| Manchester     |
| Prescott       |
| Graettinger    |
| Cahone         |
+----------------+
20 rows in set (0.01 sec)


************************************************************************** question 16 *******************************************************************************

mysql> select distinct CITY from STATION where CITY NOT RLIKE '^[aeiouAEIOU]' AND CITY NOT RLIKE '[AEIOUaeiou]$' GROUP BY CITY;
+----------------+
| CITY           |
+----------------+
| Chignik Lagoon |
| Graettinger    |
| Hanna City     |
| Kissee Mills   |
| Loma Mar       |
| Manchester     |
| Monument       |
| Negreet        |
| Prescott       |
| Sandy Hook     |
| Slidell        |
| Tipton         |
| Turner         |
+----------------+
13 rows in set (0.00 sec)

********************************************************************* question 17  ************************************************************
uestion no. 17) 

  # create table product(product_id int primary key, product_name varchar(20),unit_price int);
  # insert into product values(1,'s8',1000),(2,'G4',800),(3,'iphone',1400);
+------------+--------------+------------+
| product_id | product_name | unit_price |
+------------+--------------+------------+
|          1 | s8           |       1000 |
|          2 | G4           |        800 |
|          3 | iphone       |       1400 |
+------------+--------------+------------+

desc product;

+--------------+-------------+------+-----+---------+-------+
| Field        | Type        | Null | Key | Default | Extra |
+--------------+-------------+------+-----+---------+-------+
| product_id   | int(11)     | NO   | PRI | NULL    |       |
| product_name | varchar(20) | YES  |     | NULL    |       |
| unit_price   | int(11)     | YES  |     | NULL    |       |
+--------------+-------------+------+-----+---------+-------+

  # create table sales(seller_id int, product_id int,buyer_id int, sale_date date, quantity int, price int,foreign key(product_id) references product(product_id));

  # insert into sales values(1,1,1,'2019-01-21',2,2000),(1,2,2,'2019-02-17',1,800),(2,2,3,'2019-06-02',1,800),(3,3,4,'2019-05-13',2,2800);

+-----------+------------+----------+------------+----------+-------+
| seller_id | product_id | buyer_id | sale_date  | quantity | price |
+-----------+------------+----------+------------+----------+-------+
|         1 |          1 |        1 | 2019-01-21 |        2 |  2000 |
|         1 |          2 |        2 | 2019-02-17 |        1 |   800 |
|         2 |          2 |        3 | 2019-06-02 |        1 |   800 |
|         3 |          3 |        4 | 2019-05-13 |        2 |  2800 |
+-----------+------------+----------+------------+----------+-------+

desc sales;

+------------+---------+------+-----+---------+-------+
| Field      | Type    | Null | Key | Default | Extra |
+------------+---------+------+-----+---------+-------+
| seller_id  | int(11) | YES  |     | NULL    |       |
| product_id | int(11) | YES  | MUL | NULL    |       |
| buyer_id   | int(11) | YES  |     | NULL    |       |
| sale_date  | date    | YES  |     | NULL    |       |
| quantity   | int(11) | YES  |     | NULL    |       |
| price      | int(11) | YES  |     | NULL    |       |
+------------+---------+------+-----+---------+-------+

select product_id, product_name
    -> from product
    -> where product_id not in (select product_id from sales where sale_date NOT between '2019-01-01' and '2019-03-31');  
	
	
+------------+--------------+
| product_id | product_name |
+------------+--------------+
|          1 | s8           |
+------------+--------------+

***************************************************************** question. 18*************************************************************************

create table views(article_id int, author_id int, viewer_id int, view_date date);



insert into views values(1, 3 ,5, '2019-08-01'),
                         (1, 3, 6, '2019-08-02'),
                         (2, 7 ,7 ,'2019-08-01'),
                         (2, 7, 6, '2019-08-02'),
                         (4, 7, 1, '2019-07-22'),
                         (3, 4, 4, '2019-07-21'),
                         (3 ,4, 4 ,'2019-07-21');
						 
select * from views;
+------------+-----------+-----------+------------+
| article_id | author_id | viewer_id | view_date  |
+------------+-----------+-----------+------------+
|          1 |         3 |         5 | 2019-08-01 |
|          1 |         3 |         6 | 2019-08-02 |
|          2 |         7 |         7 | 2019-08-01 |
|          2 |         7 |         6 | 2019-08-02 |
|          4 |         7 |         1 | 2019-07-22 |
|          3 |         4 |         4 | 2019-07-21 |
|          3 |         4 |         4 | 2019-07-21 |
+------------+-----------+-----------+------------+		

select distinct author_id as id from views where author_id= viewer_id order by author_id  asc;
+------+
| id   |
+------+
|    4 |
|    7 |
+------+



********************************************************************** question 19*********************************************************************************			 

create table Delivery(delivery_id int primary key,customer_id int, order_date date, customer_pref_delivery_date date);
 
insert into Delivery values(1,1, '2019-08-01', '2019-08-02'),
                           (2, 5, '2019-08-02', '2019-08-02'),
                           (3, 1, '2019-08-11', '2019-08-11'),
                           (4,3, '2019-08-24','2019-08-26'),
                           (5, 4, '2019-08-21','2019-08-22'),
                           (6, 2, '2019-08-11','2019-08-13');
						   
						select * from Delivery;
+-------------+-------------+------------+-----------------------------+
| delivery_id | customer_id | order_date | customer_pref_delivery_date |
+-------------+-------------+------------+-----------------------------+
|           1 |           1 | 2019-08-01 | 2019-08-02                  |
|           2 |           5 | 2019-08-02 | 2019-08-02                  |
|           3 |           1 | 2019-08-11 | 2019-08-11                  |
|           4 |           3 | 2019-08-24 | 2019-08-26                  |
|           5 |           4 | 2019-08-21 | 2019-08-22                  |
|           6 |           2 | 2019-08-11 | 2019-08-13                  |
+-------------+-------------+------------+-----------------------------+  

mysql> select round(100*sum(case when order_date=customer_pref_delivery_date then 1 else 0 end)/count(1), 2) immediate_percentage
    -> from Delivery;
+----------------------+
| immediate_percentage |
+----------------------+
|                33.33 |
+-----------------------


********************************************************************** question 20 *********************************************************

 CREATE table ads(ad_id int, user_id int, action enum ('Clicked', 'Viewed', 'Ignored'));
 
 alter table ads add primary key(ad_id,user_id);
 
  desc ads;
+---------+------------------------------------+------+-----+---------+-------+
| Field   | Type                               | Null | Key | Default | Extra |
+---------+------------------------------------+------+-----+---------+-------+
| ad_id   | int(11)                            | NO   | PRI | 0       |       |
| user_id | int(11)                            | NO   | PRI | 0       |       |
| action  | enum('Clicked','Viewed','Ignored') | YES  |     | NULL    |       |
+---------+------------------------------------+------+-----+---------+-------+
 
insert into ads values(1,1,'Clicked'),
                      (2,2,'Clicked'),
                      (3,3,'Viewed'),
                      (5,5,'Ignored'),
                      (1,7,'Ignored'),
                      (2,7, 'Viewed'),
                      (3, 5, 'Clicked'),
                      (1,4,'Viewed'),
                      (2,11,'Viewed'),
                      (1,2,'Clicked');
					  
select * from ads;
+-------+---------+---------+
| ad_id | user_id | action  |
+-------+---------+---------+
|     1 |       1 | Clicked |
|     1 |       2 | Clicked |
|     1 |       4 | Viewed  |
|     1 |       7 | Ignored |
|     2 |       2 | Clicked |
|     2 |       7 | Viewed  |
|     2 |      11 | Viewed  |
|     3 |       3 | Viewed  |
|     3 |       5 | Clicked |
|     5 |       5 | Ignored |
+-------+---------+---------+
10 rows in set (0.00 sec)	  

 select
 ad_id, round(avg(case when action='clicked' then 1 else 0 end )*100,2) ctr
 from ads
 group by ad_id
 order by ad_id,ctr desc;
+-------+-------+
| ad_id | ctr   |
+-------+-------+
|     1 | 50.00 |
|     2 | 33.33 |
|     3 | 50.00 |
|     5 |  0.00 |
+-------+-------+
4 rows in set (0.02 sec)

**************************************************************** question 21 *********************************************************************************************

create table employee(employee_id int primary key, team_id int);

  insert into employee values(1,8),
                             (2,8),
                             (3,8),
                             (4,7),
                             (5,9),
                             (6,9);
							 
select * from employee;
+-------------+---------+
| employee_id | team_id |
+-------------+---------+
|           1 |       8 |
|           2 |       8 |
|           3 |       8 |
|           4 |       7 |
|           5 |       9 |
|           6 |       9 |
+-------------+---------+
6 rows in set (0.00 sec)
	

	select t1.employee_id, t2.team_size
from Employee as t1
inner join (select team_id, count(1) as team_size
    from Employee
    group by team_id) as t2
on t1.team_id = t2.team_id

*************************************************************************** question 22 **************************************************************************************************

create table countries(country_id int primary key,country_name varchar(25));
mysql> select * from countries;
+------------+--------------+
| country_id | country_name |
+------------+--------------+
|          2 | USA          |
|          3 | Australia    |
|          5 | China        |
|          7 | Peru         |
|          8 | Morocco      |
|          9 | Spain        |
+------------+--------------+

create table weather(country_id int, weather_state int, day date);
+------------+---------------+------------+
| country_id | weather_state | day        |
+------------+---------------+------------+
|          2 |            12 | 2019-10-27 |
|          2 |            12 | 2019-10-28 |
|          2 |            15 | 2019-11-01 |
|          3 |            -2 | 2019-11-10 |
|          3 |             0 | 2019-11-11 |
|          3 |             3 | 2019-11-12 |
|          5 |            16 | 2019-11-07 |
|          5 |            18 | 2019-11-09 |
|          5 |            21 | 2019-11-23 |
|          7 |            25 | 2019-11-28 |
|          7 |            22 | 2019-12-01 |
|          7 |            20 | 2019-12-02 |
|          8 |            25 | 2019-11-05 |
|          8 |            27 | 2019-11-15 |
|          8 |            31 | 2019-11-25 |
|          9 |             7 | 2019-10-23 |
|          9 |             3 | 2019-12-23 |
+------------+---------------+------------+

insert into countries values(2,'USA'),
                             (3,'Australia'),
                             (7,'Peru'),
                             (5,'China'),
                             (8,'Morocco'),
                             (9,'Spain');
							 
							 
							 
		insert into weather values (2, 15, '2019-11-01'),
									(2 ,12 ,'2019-10-28'),
									(2, 12, '2019-10-27'),
									(3 ,-2, '2019-11-10'),
									(3 ,0,'2019-11-11'),
									(3, 3 ,'2019-11-12'),
									(5, 16 ,'2019-11-07'),
									(5 ,18, '2019-11-09'),
									(5 ,21, '2019-11-23'),
									(7 ,25, '2019-11-28'),
									(7, 22, '2019-12-01'),
									(7 ,20, '2019-12-02'),
									(8, 25, '2019-11-05'),
									(8, 27, '2019-11-15'),
									(8, 31,'2019-11-25'),
									(9, 7, '2019-10-23'),
									(9 ,3, '2019-12-23');
									

alter table weather add primary key(country_id,day);


select country_name, case when avg(weather_state) <= 15 then "Cold"
                          when avg(weather_state) >= 25 then "Hot"
                          else "Warm" end as weather_type
from Countries inner join Weather
on Countries.country_id = Weather.country_id
where left(day, 7) = '2019-11'
group by country_name

+--------------+--------------+
| country_name | weather_type |
+--------------+--------------+
| Australia    | Cold         |
| China        | Warm         |
| Morocco      | Hot          |
| Peru         | Hot          |
| USA          | Cold         |
+--------------+--------------+
*********************************** ******************************** question 23 ******************************************************************************

create table prices(product_id int,start_date date, end_date date, price int);

alter table prices add primary key(product_id,start_date,end_date);

create table UnitsSold(product_id int,purchase_date  date, units int);



insert into prices values(1,'2019-02-17','2019-02-28', 5),
                  (1, '2019-03-01', '2019-03-22', 20),
                  (2, '2019-02-01', '2019-02-20', 15),
                  (2, '2019-02-21', '2019-03-31', 30);
				  
+------------+------------+------------+-------+
| product_id | start_date | end_date   | price |
+------------+------------+------------+-------+
|          1 | 2019-02-17 | 2019-02-28 |     5 |
|          1 | 2019-03-01 | 2019-03-22 |    20 |
|          2 | 2019-02-01 | 2019-02-20 |    15 |
|          2 | 2019-02-21 | 2019-03-31 |    30 |
+------------+------------+------------+-------+		  
				  
				 
				 
				 
insert into UnitsSold values(1, '2019-02-25', 100),
                            (1,'2019-03-01', 15),
                            (2,'2019-02-10' ,200),
                            (2, '2019-03-22' ,30);
							
++------------+---------------+-------+
| product_id | purchase_date | units |
+------------+---------------+-------+
|          1 | 2019-02-25    |   100 |
|          1 | 2019-03-01    |    15 |
|          2 | 2019-02-10    |   200 |
|          2 | 2019-03-22    |    30 |
+------------+---------------+-------+

select p.product_id,
round(cast(sum(p.price*us.units) as decimal)/sum(us.units),2)
from prices as p, UnitsSold as us
where us.purchase_date between p. start_date and p.end_date
and p.product_id= us.product_id
group by p.product_id;

+------------+---------------------------------------------------------------+
| product_id | round(cast(sum(p.price*us.units) as decimal)/sum(us.units),2) |
+------------+---------------------------------------------------------------+
|          1 |                                                          6.96 |
|          2 |                                                         16.96 |
+------------+---------------------------------------------------------------+
2 rows in set (0.00 sec)
************************************************************ question 24 ****************************************************


SELECT a.player_id, MIN(a.event_date) AS first_login
    FROM Activity a
    GROUP BY a.player_id;
	
+-----------+-------------+
| player_id | first_login |
+-----------+-------------+
|         1 | 2016-03-01  |
|         2 | 2017-06-25  |
|         3 | 2016-03-02  |
+-----------+-------------+
3 rows in set (0.01 sec)



*********************************************************** question 25 ************************************************************888


create table activity(player_id int,device_id int, event_date date,games_played int);

alter table activity add primary key(player_id,event_date);

insert into activity values(1, 2, '2016-03-01',5),
                           (1, 2 ,'2016-05-02', 6),
                           (2, 3,'2017-06-25', 1),
                           (3, 1,'2016-03-02', 0),
                           (3, 4, '2018-07-03', 5);
				
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
|         1 |         2 | 2016-03-01 |            5 |
|         1 |         2 | 2016-05-02 |            6 |
|         2 |         3 | 2017-06-25 |            1 |
|         3 |         1 | 2016-03-02 |            0 |
|         3 |         4 | 2018-07-03 |            5 |
+-----------+-----------+------------+--------------+


select player_id, min(event_date) 'first_login'
from Activity
group by player_id;
+-----------+-------------+
| player_id | first_login |
+-----------+-------------+
|         1 | 2016-03-01  |
|         2 | 2017-06-25  |
|         3 | 2016-03-02  |
+-----------+-------------+
 select player_id, device_id
from activity a1
where a1.event_date<=all(select a2.event_date from activity a2 where a1.player_id=a2.player_id);
 
 -----------+-----------+
| player_id | device_id |
+-----------+-----------+
|         1 |         2 |
|         2 |         3 |
|         3 |         1 |
+-----------+-----------+
 
another Approach------
select a.player_id, a.device_id
from Activity a JOIN
(select player_id, min(event_date) 'first_login'
from Activity group by player_id) t



********************************************************************** question 26 *******************************************************************8

create table products(product_id int primary key, product_name varchar(40), product_category varchar(20));

create table orders(product_id int, order_date date, unit int, foreign key (product_id) references products(product_id));



insert into products values(1,'leetcode solutions','book'),
                           (2,'jewels of stingology','book'),
                           (3,'hp', 'laptop'),
                           (4,'lenovo', 'laptop'),
                          (5,'leetcode kit','T-shirt');

+------------+----------------------+------------------+
| product_id | product_name         | product_category |
+------------+----------------------+------------------+
|          1 | leetcode solutions   | book             |
|          2 | jewels of stingology | book             |
|          3 | hp                   | laptop           |
|          4 | lenovo               | laptop           |
|          5 | leetcode kit         | T-shirt          |
+------------+----------------------+------------------+


insert into orders values(1,'2020-02-05',60),
                  (1, '2020-02-10', 70),
                  (2, '2020-01-18', 30),
                  (2, '2020-02-11',80),
                  (3, '2020-02-17', 2),
                  (3, '2020-02-24', 3),
                  (4, '2020-03-01', 20),
                  (4, '2020-03-04', 30),
                  (4, '2020-03-04', 60),
                  (5, '2020-02-25', 50),
                  (5, '2020-02-27', 50),
                  (5, '2020-03-01', 50);
				  
+------------+------------+------+
| product_id | order_date | unit |
+------------+------------+------+
|          1 | 2020-02-05 |   60 |
|          1 | 2020-02-10 |   70 |
|          2 | 2020-01-18 |   30 |
|          2 | 2020-02-11 |   80 |
|          3 | 2020-02-17 |    2 |
|          3 | 2020-02-24 |    3 |
|          4 | 2020-03-01 |   20 |
|          4 | 2020-03-04 |   30 |
|          4 | 2020-03-04 |   60 |
|          5 | 2020-02-25 |   50 |
|          5 | 2020-02-27 |   50 |
|          5 | 2020-03-01 |   50 |
+------------+------------+------+

SELECT
    t2.product_name,
    t1.unit
FROM (
SELECT
    product_id,
    SUM(unit) as unit
FROM Orders
WHERE DATE_FORMAT(order_date, '%Y-%m') = '2020-02'
GROUP BY 1
HAVING SUM(unit) >= 100
    ) as t1 JOIN Products as t2
ON t1.product_id = t2.product_id;

+--------------------+------+
| product_name       | unit |
+--------------------+------+
| leetcode solutions |  130 |
| leetcode kit       |  100 |
+--------------------+------+

****************************************************************** question 27 ****************************************************************************************

create table users(user_id int primary key, name varchar(20), mail varchar(50));

insert into users values(1,'Winston' ,'winston@leetcode.com'),
                        (2, 'Jonathan', 'jonathanisgreat'),
                        (3, 'Annabelle', 'bella-@leetcode.com'),
                        (4, 'Sally' ,'sally.come@leetcode.com'),
                        (5, 'Marwan','quarz#2020@leetcode.com'),
                        (6, 'David' ,'david69@gmail.com'),
                        (7, 'Shapiro','.shapo@leetcode.com');
						
select * from users;
+---------+-----------+-------------------------+
| user_id | name      | mail                    |
+---------+-----------+-------------------------+
|       1 | Winston   | winston@leetcode.com    |
|       2 | Jonathan  | jonathanisgreat         |
|       3 | Annabelle | bella-@leetcode.com     |
|       4 | Sally     | sally.come@leetcode.com |
|       5 | Marwan    | quarz#2020@leetcode.com |
|       6 | David     | david69@gmail.com       |
|       7 | Shapiro   | .shapo@leetcode.com     |
+---------+-----------+-------------------------+

select * 
from Users
where  mail regexp '^[A-Za-z][A-Za-z0-9\_\.\-]*@leetcode\.com$';

+---------+-----------+-------------------------+
| user_id | name      | mail                    |
+---------+-----------+-------------------------+
|       1 | Winston   | winston@leetcode.com    |
|       3 | Annabelle | bella-@leetcode.com     |
|       4 | Sally     | sally.come@leetcode.com |
+---------+-----------+-------------------------+

********************************************************************* question 28 *************************************************************************************************

create table customers(customer_id int primary key, name varchar(20), country varchar(20));

insert into customers values(1,'Winston', 'USA'),
                            (2,'Jonathan', 'Peru'),
                            (3,'Moustafa', 'Egypt');
							
+-------------+----------+---------+
| customer_id | name     | country |
+-------------+----------+---------+
|           1 | Winston  | USA     |
|           2 | Jonathan | Peru    |
|           3 | Moustafa | Egypt   |
+-------------+----------+---------+

create table product1(product_id int primary key, name varchar(20),country varchar(20));

insert into product1 values(10,'LC Phone', 300),
                          (20, 'LC T-Shirt', 10),
                          (30, 'LC Book', 45),
                          (40, 'LC Keychain',2);


create table orders1(order_id int primary key, customer_id int,product_id int, order_date date, quantity int);

insert into orders1 values(1,1 ,10, '2020-06-10' ,1),
                          (2 ,1, 20, '2020-07-01', 1),
                          (3 ,1, 30, '2020-07-08', 2),
                          (4, 2, 10, '2020-06-15' ,2),
                          (5, 2, 40, '2020-07-01' ,10),
                          (6, 3, 20, '2020-06-24' ,2),
                          (7 ,3, 30, '2020-06-25', 2),
                          (9 ,3, 30, '2020-05-08' ,3);
						  
						  
SELECT customer_id, name
FROM Customers JOIN Orders1 USING(customer_id) 
    JOIN Product1 USING(product_id)
GROUP BY customer_id
HAVING SUM(IF(LEFT(order_date, 7) = '2020-06', quantity, 0) * price) >= 100
    AND SUM(IF(LEFT(order_date, 7) = '2020-07', quantity, 0) * price) >= 100;
	
	
	
***************************************************************** question 29 ******************************************************************************************

create table TVprogram(program_date date, content_id int, channel varchar(20));

alter table TVprogram add primary key(program_date,content_id);

create table content(content_id varchar(20) primary key,title varchar(30),kids_content enum ('Y', 'N'), content_type varchar(30));

insert into TVprogram values('2020-06-10 08:00', 1, 'LC-Channel'),
                            ('2020-05-11 12:00', 2, 'LC-Channel'),
                            ('2020-05-12 12:00',3, 'LC-Channel'),
                            ('2020-05-13 14:00',4, 'Disney Ch'),
                            ('2020-06-18 14:00', 4, 'Disney Ch'),
                            ('2020-07-15 16:00',5 ,'Disney Ch');
							
insert into content values(1, 'Leetcode Movie', 'N', 'Movies'),
                          (2,'Alg. for ' ,'Y','Series'),
                          (3,'Database Sols','N', 'Series'),
                          (4,'Aladdin','Y','Movies'),
						  
	insert into content values(5,'cinderella','y','Movies');

ans*****

select distinct title
from
(
  select title
  from Content c
  left join TVProgram t
  on c.content_id = t.content_id
  where Kids_content = 'Y' and content_type = 'Movies'
  and date_format(program_date, '%Y-%m') = '2020-06'
) x;

+---------+
| title   |
+---------+
| Aladdin |
+---------+
1 row in set (0.03 sec)


***************************************************************** QUESTION 30*************************************************************************************

create table NPV(id int, year int, npv int);

alter table NPV add primary key(id,year);

create table Queries(id int, year int);

alter table queries add primary key(id,year);



insert into NPV values(1, 2018, 100),
                      (7, 2020, 30),
                      (13, 2019, 40),
                      (1, 2019, 113),
                      (2, 2008, 121),
                      (3, 2009, 12),
                      (11, 2020, 99),
                      (7, 2019, 0);
			
insert into queries values
  insert into queries values(1, 2019),
                           (2, 2008),
                           (3 ,2009),
                           (7 ,2018),
                           (7 ,2019),
                           (7 ,2020),
                           (13, 2019);
						   
	
select Queries.*, if(isnull(npv), 0, npv) as npv
from Queries left join NPV
on Queries.id = NPV.id and Queries.year = NPV.year;

+----+------+------+
| id | year | npv  |
+----+------+------+
|  1 | 2019 |  113 |
|  2 | 2008 |  121 |
|  3 | 2009 |   12 |
|  7 | 2018 |    0 |
|  7 | 2019 |    0 |
|  7 | 2020 |   30 |
| 13 | 2019 |   40 |
+----+------+------+
7 rows in set (0.02 sec)

********************************************************************* question 31 ************************************************************************

mysql> select q.id, q.year, ifnull(n.npv,0) as npv
    -> from queries as q
    -> left join npv as n
    -> on (q.id, q.year) = (n.id, n.year);
+----+------+-----+
| id | year | npv |
+----+------+-----+
|  1 | 2019 | 113 |
|  2 | 2008 | 121 |
|  3 | 2009 |  12 |
|  7 | 2018 |   0 |
|  7 | 2019 |   0 |
|  7 | 2020 |  30 |
| 13 | 2019 |  40 |
+----+------+-----+
7 rows in set (0.01 sec)



******************************************************************************** question 32 ********************************************************************888

create table employees(id int primary key, name varchar(20));

create table employeeUNI(id int, unique_id int);

alter table employeeUNI add primary key(id,unique_id);

insert into employees values (1, 'Alice'),
                           (7, 'Bob'),
                           (11,'Meir'),
                           (90,'Winston'),
                           (3, 'Jonathan');
  id | name     |
+----+----------+
|  1 | Alice    |
|  3 | Jonathan |
|  7 | Bob      |
| 11 | Meir     |
| 90 | Winston  |
+----+----------+
						   
insert into employeeUNI values  (3, 1),
                                  (11 ,2),
                                  (90 ,3);
+----+-----------+
| id | unique_id |
+----+-----------+
|  3 |         1 |
| 11 |         2 |
| 90 |         3 |
+----+-----------+

mysql> SELECT
    ->     unique_id,
    ->     name
    -> FROM (
    -> SELECT
    ->     e.id,
    ->     e.name,
    ->     eu.unique_id
    -> FROM EMployees as e LEFT JOIN EmployeeUNI as eu
    -> ON e.id = eu.id
    ->     ) x;
	
	
	
	
+-----------+----------+
| unique_id | name     |
+-----------+----------+
|      NULL | Alice    |
|         1 | Jonathan |
|      NULL | Bob      |
|         2 | Meir     |
|         3 | Winston  |
+-----------+----------+
5 rows in set (0.01 sec)







****************************************************************** question no. 33 **************************************************************************

create table users1(id int primary key, name varchar(20));

create table rides(id int primary key,user_id int, distance int);

insert into users1 values(1,'alice'),
                         (2,'Bob'),
                         (3,'alex'),
                         (4,'donald'),
                         (7,'lee'),
                         (13,'jonathan'),
                         (19,'elvis');
+----+----------+
| id | name     |
+----+----------+
|  1 | alice    |
|  2 | Bob      |
|  3 | alex     |
|  4 | donald   |
|  7 | lee      |
| 13 | jonathan |
| 19 | elvis    |
+----+----------+

create table rides(id int primary key,user_id int, distance int);

insert into rides values(1, 1, 120),
                        (2, 2, 317),
                        (3, 3, 222),
                        (4, 7, 100),
                        (5, 13, 312),
                        (6, 19, 50),
                        (7, 7, 120),
                        (8, 19, 400),
                        (9,7, 230);
						
+----+---------+----------+
| id | user_id | distance |
+----+---------+----------+
|  1 |       1 |      120 |
|  2 |       2 |      317 |
|  3 |       3 |      222 |
|  4 |       7 |      100 |
|  5 |      13 |      312 |
|  6 |      19 |       50 |
|  7 |       7 |      120 |
|  8 |      19 |      400 |
|  9 |       7 |      230 |
+----+---------+----------+


SELECT
    u.name,
    IFNULL(SUM(distance),0) as travelled_distance
FROM Users1 as u LEFT JOIN Rides as r
ON r.user_id = u.id
GROUP BY 1
ORDER BY 2 DESC;


+----------+--------------------+
| name     | travelled_distance |
+----------+--------------------+
| elvis    |                450 |
| lee      |                450 |
| Bob      |                317 |
| jonathan |                312 |
| alex     |                222 |
| alice    |                120 |
| donald   |                  0 |
+----------+--------------------+

******************************************************************************** 34 same as 26 **************************************************************

********************************************************************************* question 35 **********************************************************************

CREATE TABLE movies(movie_id INT PRIMARY KEY, title VARCHAR(20));

CREATE TABLE users2(user_id INT PRIMARY KEY, name VARCHAR(20));

CREATE TABLE MovieRating(movie_id INT, user_id INT, rating INT, created_at DATE);

ALTER TABLE MovieRating ADD PRIMARY KEY(movie_id,user_id);


INSERT INTO movies VALUES(1, 'Avengers'),
                         (2, 'Frozen 2'),
                         (3, 'Joker');
+----------+----------+
| movie_id | title    |
+----------+----------+
|        1 | Avengers |
|        2 | Frozen 2 |
|        3 | Joker    |
+----------+----------+

INSERT INTO users2 VALUES(1,'Daniel'),
                         (2, 'Monica'),
                          (3, 'Maria'),
                          (4, 'James');

+---------+--------+
| user_id | name   |
+---------+--------+
|       1 | Daniel |
|       2 | Monica |
|       3 | Maria  |
|       4 | James  |
+---------+--------+				  

INSERT INTO MovieRating VALUES(1, 1, 3, '2020-01-12'),
                               (1, 2, 4,'2020-02-11'),
                               (1, 3, 2, '2020-02-12'),
                               (1, 4, 1, '2020-01-01'),
                               (2, 1, 5, '2020-02-17'),
                               (2, 2, 2, '2020-02-01'),
                               (2, 3, 2, '2020-03-01'),
                               (3, 1, 3, '2020-02-22'),
                               (3, 2, 4, '2020-02-25');

+----------+---------+--------+------------+
| movie_id | user_id | rating | created_at |
+----------+---------+--------+------------+
|        1 |       1 |      3 | 2020-01-12 |
|        1 |       2 |      4 | 2020-02-11 |
|        1 |       3 |      2 | 2020-02-12 |
|        1 |       4 |      1 | 2020-01-01 |
|        2 |       1 |      5 | 2020-02-17 |
|        2 |       2 |      2 | 2020-02-01 |
|        2 |       3 |      2 | 2020-03-01 |
|        3 |       1 |      3 | 2020-02-22 |
|        3 |       2 |      4 | 2020-02-25 |
+----------+---------+--------+------------+


ans;;;;;;

(
select name
from users2 u
join (
    select user_id, count(*) cnt
    from movierating
    group by user_id
    order by cnt
    limit 1) f1
on u.user_id = f1.user_id)
union
(
select title
from movies m
join (
    select movie_id, avg(rating) avgr
    from movierating
    where left(created_at,7) = '2020-02'
    group by movie_id
    order by avgr
    limit 1) f2
on m.movie_id = f2.movie_id);

********************************* question 36 same as 33 and 37 same as 32 ****************************************

********************************* question 38 *******************************36,37repeat

create table departments(id int primary key, name varchar(50));

create table students(id int primary key,name varchar(50), department_id int);

insert into Departments values(1, 'Electrical Engineering'),
                             (7, 'Computer Engineering'),
                             (13, 'Business Administration');
							 
+----+-------------------------+
| id | name                    |
+----+-------------------------+
|  1 | Electrical Engineering  |
|  7 | Computer Engineering    |
| 13 | Business Administration |
+----+-------------------------+
							 
insert into students values(23,'Alice', 1),
                           (1, 'Bob', 7),
                           (5, 'Jennifer', 13),
                           (2 ,'John', 14),
                           (4 ,'Jasmine', 77),
                           (3 ,'Steve', 74),
                           (6 ,'Luis', 1),
                           (8 ,'onathan', 7),
                           (7 ,'Daiana', 33),
                           (11 ,'Madelynn', 1);
						   
+----+----------+---------------+
| id | name     | department_id |
+----+----------+---------------+
|  1 | Bob      |             7 |
|  2 | John     |            14 |
|  3 | Steve    |            74 |
|  4 | Jasmine  |            77 |
|  5 | Jennifer |            13 |
|  6 | Luis     |             1 |
|  7 | Daiana   |            33 |
|  8 | onathan  |             7 |
| 11 | Madelynn |             1 |
| 23 | Alice    |             1 |
+----+----------+---------------+


mysql> select id, name from Students where department_id not in (select id from Departments);

+----+---------+
| id | name    |
+----+---------+
|  2 | John    |
|  3 | Steve   |
|  4 | Jasmine |
|  7 | Daiana  |
+----+---------+
4 rows in set (0.03 sec)



*********************************************************************** question 39 ******************************************************************************************

create table calls(from_id int, to_id int, duration int);
insert into calls values(1,2,59),
						(2 ,1,11),
						(1,3,20),
						(3,4, 100),
						(3,4, 200),
						(3,4 ,200),
						(4,3, 499);
						
mysql> select * from calls;
+---------+-------+----------+
| from_id | to_id | duration |
+---------+-------+----------+
|       1 |     2 |       59 |
|       2 |     1 |       11 |
|       1 |     3 |       20 |
|       3 |     4 |      100 |
|       3 |     4 |      200 |
|       3 |     4 |      200 |
|       4 |     3 |      499 |
+---------+-------+----------+
7 rows in set (0.00 sec)

select count(duration) as total_duration from calls

mysql> select from_id as person1,to_id as person2,
    ->     count(duration) as call_count, sum(duration) as total_duration
    -> from (select *
    ->       from Calls
    ->
    ->       union all
    ->
    ->       select to_id, from_id, duration
    ->       from Calls) t1
    -> where from_id < to_id
    -> group by person1, person2;
+---------+---------+------------+----------------+
| person1 | person2 | call_count | total_duration |
+---------+---------+------------+----------------+
|       1 |       2 |          2 |             70 |
|       1 |       3 |          1 |             20 |
|       3 |       4 |          4 |            999 |
+---------+---------+------------+----------------+
3 rows in set (0.01 sec)


******************************************  question 40 **************************************************23 and 40 same question


create table prices(product_id int, start_date date, end_date date, price int);


****************************************** question 41 ************************************************

crate table warehoues(name varchar(25), product_id int, units int);
alter table warehouse add primary key(name, product_id);

create table products1(product_id int primary key, product_name varchar(25), Width int, Length int,Height int);

insert into warehouse values('LCHouse1', 1,1),
							('LCHouse1', 2,10),
							('LCHouse1', 3,5),
							('LCHouse2', 1,2),
							('LCHouse2', 2,2),
							('LCHouse3', 4,1);

+----------+------------+-------+
| name     | product_id | units |
+----------+------------+-------+
| LCHouse1 |          1 |     1 |
| LCHouse1 |          2 |    10 |
| LCHouse1 |          3 |     5 |
| LCHouse2 |          1 |     2 |
| LCHouse2 |          2 |     2 |
| LCHouse3 |          4 |     1 |
+----------+------------+-------+
6 rows in set (0.01 sec)


insert into products1 values(1,'LC-TV', 5, 50, 40),
							(2, 'LC-KeyChain', 5, 5, 5),
							(3,'LC-Phone', 2, 10, 10),
							(4, 'LC-T-Shirt', 4 ,10, 20);
							
+------------+--------------+-------+--------+--------+
| product_id | product_name | Width | Length | Height |
+------------+--------------+-------+--------+--------+
|          1 | LC-TV        |     5 |     50 |     40 |
|          2 | LC-KeyChain  |     5 |      5 |      5 |
|          3 | LC-Phone     |     2 |     10 |     10 |
|          4 | LC-T-Shirt   |     4 |     10 |     20 |
+------------+--------------+-------+--------+--------+
4 rows in set (0.00 sec)

select warehouse_name, sum(volume) as volume from (
    select w.name as warehouse_name, w.product_id, w.units * Width * Length * Height as volume
    from Warehouse w left join Products1 p on w.product_id = p.product_id
) t group by warehouse_name;


output:-
+----------------+--------+
| warehouse_name | volume |
+----------------+--------+
| LCHouse1       |  12250 |
| LCHouse2       |  20250 |
| LCHouse3       |    800 |
+----------------+--------+
3 rows in set (0.02 sec)



*****************************************question 42 ***********************************************

crate table sales1(sales_date DATE, fruit VARCHAR(20), sold_num INT);

alter table sales1 add primary key (sales_date,fruit);

insert into sales1 values('2020-05-01','apples', 10),
						 ('2020-05-01', 'oranges',8),
						 ('2020-05-02', 'apples',15),
						 ('2020-05-02', 'oranges', 15),
						 ('2020-05-03', 'apples', 20),
						 ('2020-05-03', 'oranges', 0),
						 ('2020-05-04', 'apples', 15),
						 ('2020-05-04', 'oranges', 6);
					
select date(sales_date) as sales_date,
		sum(case when fruit = 'apples' then sold_num
				 when fruit = 'oranges' then -sold_num end) as diff
from sales1
group by 1
order by 1;

+------------+------+
| sales_date | diff |
+------------+------+
| 2020-05-01 |    2 |
| 2020-05-02 |    0 |
| 2020-05-03 |   20 |
| 2020-05-04 |    9 |
+------------+------+
4 rows in set (0.00 sec)

********************************************** question 43 ****************************
CREATE TABLE activity (player_id int, device_id int, event date, games_played int);

alter table activity add primary key (player_id,event);

mysql> desc activity;
+--------------+---------+------+-----+------------+-------+
| Field        | Type    | Null | Key | Default    | Extra |
+--------------+---------+------+-----+------------+-------+
| player_id    | int(11) | NO   | PRI | 0          |       |
| device_id    | int(11) | YES  |     | NULL       |       |
| event_date   | date    | NO   | PRI | 0000-00-00 |       |
| games_played | int(11) | YES  |     | NULL       |       |
+--------------+---------+------+-----+------------+-------+
4 rows in set (0.01 sec)

+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
|         1 |         2 | 2016-03-01 |            5 |
|         1 |         2 | 2016-05-02 |            6 |
|         2 |         3 | 2017-06-25 |            1 |
|         3 |         1 | 2016-03-02 |            0 |
|         3 |         4 | 2018-07-03 |            5 |
+-----------+-----------+------------+--------------+
5 rows in set (0.00 sec)



WITH temp_activity AS (
						SELECT 
								player_id,
								LEAD(event_date, 1) OVER(PARTITION BY player_id ORDER BY event_date)  - event_date  AS difference
						FROM 
								activity
			),

	temp_activity2 AS (
						SELECT 
								COUNT(DISTINCT player_id) AS players_count
						FROM 	
								temp_activity
						WHERE 
								difference = 1
						GROUP BY 
								player_id
			)

SELECT 
		ROUND(COUNT(*) / (SELECT COUNT(DISTINCT player_id) FROM activity), 2) AS fraction
FROM 
		temp_activity2;




*********************************************** question 44 ******************************

CREATE TABLE employee_1(id INT primary key, name VARCHAR(20), department VARCHAR(20), managerID INT);

insert into employee_1 values(101, 'John', 'A', null),
							(102, 'Dan', 'A', 101),
							(103, 'James', 'A' ,101),
							(104, 'Amy', 'A', 101),
							(105, 'Anne', 'A', 101),
							(106, 'Ron', 'B', 101);
							
							
select 
    a.name 
from 
    employee_1 a 
inner join 
    employee_1 b 
on (a.id = b.managerid) 
group by a.name 
having count(distinct b.id) >= 5;

+------+
| name |
+------+
| John |
+------+

************************************************** question 45 ***********************************

CREATE TABLE student( student_id INT, student_name VARCHAR(11), gender VARCHAR(1), dept_id INT);

CREATE TABLE department(dept_id INT, dept_name VARCHAR(20));

INSERT INTO student VALUES(1 ,'Jack', 'M', 1),
                           (2, 'Jane', 'F', 1),
                           (3, 'Mark', 'M', 2);
						 
INSERT INTO department VALUES(1, 'Engineering'),
                              (2, 'Science'),
                              (3, 'Law');
							  
select 
    a.dept_name,
    coalesce(count(student_id), 0) student_number
from 
    department a 
left join
    student b
on 
    (a.dept_id = b.dept_id)
group by a.dept_name
order by student_number desc, a.dept_name asc;

+-------------+----------------+
| dept_name   | student_number |
+-------------+----------------+
| Engineering |              2 |
| Science     |              1 |
| Law         |              0 |
+-------------+----------------+
3 rows in set (0.02 sec)

********************************************* question 46 ****************************************

CREATE TABLE customer (customer_id INT, product_key INT, FOREIGN KEY(product_key) references product_1 (product_key));

CREATE TABLE product_1(product_key int PRIMARY KEY);


insert into customer values(1, 5),
							(2, 6),
							(3, 5),
							(3, 6),
							(1, 6);


insert into product_1 values(5),(6);


SELECT
    customer_id
FROM customer
GROUP BY customer_id
HAVING COUNT( DISTINCT product_key) = (SELECT COUNT(*) FROM product_1);

+-------------+
| customer_id |
+-------------+
|           1 |
|           3 |
+-------------+

SELECT 
	customer_id,
	COUNT( DISTINCT product_key) unique_product
FROM customer
GROUP BY customer_id;

So, lets first group the data by customer_id and count how many unique products each customer has bought.

+-------------+----------------+
| customer_id | unique_product |
+-------------+----------------+
|           1 |              2 |
|           2 |              1 |
|           3 |              2 |
+-------------+----------------+
3 rows in set (0.01 sec)

*********************************************** question 47 ************************************* using oracle DATABASE

CREATE TABLE project ( project_id INT, employee_id INT);

ALTER TABLE project ADD PRIMARY KEY(project_id, employee_id);


SQL> desc project;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 PROJECT_ID                                NOT NULL NUMBER(38)
 EMPLOYEE_ID                               NOT NULL NUMBER(38)
 
 

CREATE TABLE Employee_2 (employee_id INT PRIMARY KEY, name VARCHAR(10), experience_years INT);


insert into project values(1, 1);
insert into project values(1, 2);
insert into project values(1, 3);
insert into project values(2, 1);
insert into project values(2, 4);
							
insert into employee_2 values(1, 'Khaled',3),
insert into employee_2 values(2, 'Ali', 2),
insert into employee_2 values(3, 'John', 3),
insert into employee_2 values(4, 'Doe', 2);
							 
							 
SELECT 
		project_id,
		employee_id
FROM
		(
			SELECT 
					p.project_id, 
					e.employee_id,
					DENSE_RANK() OVER(PARTITION BY p.project_id ORDER BY e.experience_years DESC) AS ranking
			FROM 
					employee_2 e
			INNER JOIN 
					project p
			ON 
					e.employee_id = p.employee_id
		) temp_employee
WHERE 
		ranking = 1;
		

PROJECT_ID  EMPLOYEE_ID
----------  -----------
         1           1
         1           3
         2           1

******************************************* question 48 **********************************

CREATE TABLE books (book_id INT primary key, name VARCHAR(30), available_from date);


CREATE TABLE orders_1 (order_id INT PRIMARY KEY, book_id INT, quantity INT, dispatch_date date, FOREIGN KEY(book_id) REFERENCES books(book_id));



insert into books values (1,"Kalila AndDemna" ,'2010-01-01'),
                         (2, "28 Letters" ,'2012-05-12'),
                         (3, "The Hobbit" ,'2019-06-10'),
                         (4,"13 Reasons Why" ,'2019-06-01'),
                         (5,"The Hunger Games", '2008-09-21');
						 

insert into orders_1 values(1,1,2,'2018-07-26'),
                           (2, 1, 1,'2018-11-05'),   
                           (3, 3, 8,'2019-06-11'),    
                           (4, 4,6,'2019-06-05'),   
                           (5, 4, 5,'2019-06-20'),    
                           (6, 5, 9,'2009-02-02'),   
                           (7, 5, 8,'2010-04-13');   
						   
						  

	SELECT 
		b.book_id, b.name
FROM 
		books b
LEFT JOIN 
		orders_1 o
ON 
		b.book_id = o.book_id 
WHERE 
		available_from < '2019-05-23' 
		AND 
        (o.dispatch_date BETWEEN '2018-06-23' AND '2019-06-23')
		OR 
        dispatch_date IS NULL
GROUP BY  
		b.book_id,
        b.name
HAVING 
		COALESCE(SUM(o.quantity), 0) < 10;
		

+---------+-----------------+
| book_id | name            |
+---------+-----------------+
|       1 | Kalila AndDemna |
|       2 | 28 Letters      |
+---------+-----------------+

******************************************** question 49 *************************************using oracle DATABASE

CREATE TABLE Enrollments(student_id INT, course_id INT, grade INT);

ALTER TABLE Enrollments ADD PRIMARY KEY(student_id, course_id);

INSERT INTO enrollments values(2, 2, 95);
INSERT INTO enrollments values(2, 3, 95);
INSERT INTO enrollments values(1, 1, 90);
INSERT INTO enrollments values(1, 2, 99);
INSERT INTO enrollments values(3, 1, 80);
INSERT INTO enrollments values(3, 2, 75);
INSERT INTO enrollments values(3, 3, 82);
									
									
SELECT
    student_id,
    course_id,
    grade
FROM (
SELECT
    student_id,
    course_id,
    grade,
    DENSE_RANK() OVER(PARTITION BY student_id ORDER BY grade DESC, course_id) as rnk
FROM enrollments
    ) x
WHERE rnk=1
ORDER BY 1;


STUDENT_ID  COURSE_ID      GRADE
---------- ---------- ----------
         1          2         99
         2          2         95
         3          3         82


********************************************* question 50 *******************************

CREATE TABLE players(player_id INT, group_id INT);

CREATE TABLE matches(match_id INT PRIMARY KEY,first_player INT,second_player INT,first_score INT,second_score INT);


INSERT INTO players VALUES(15, 1);
INSERT INTO players VALUES(25, 1);
INSERT INTO players VALUES(30, 1);
INSERT INTO players VALUES(45, 1);
INSERT INTO players VALUES(10, 2);
INSERT INTO players VALUES(35, 2);
INSERT INTO players VALUES(50, 2);
INSERT INTO players VALUES(20, 3);
INSERT INTO players VALUES(40, 3);
						
INSERT INTO matches VALUES(1,30,45,10,12);
INSERT INTO matches VALUES(2,20,50,5,5);
INSERT INTO matches VALUES(13,65,45,10,10);
INSERT INTO matches VALUES(5,30,65,3,15);
INSERT INTO matches VALUES(42,45,65,8,4);
INSERT INTO matches VALUES(52,45,25,4,8);


select group_id, player_id from (
	select p.group_id, ps.player_id, sum(ps.score) as score
	from Players p,
	    (
            select first_player as player_id, first_score as score
            from Matches
            union all
            select second_player, second_score
            from Matches
	    ) ps
	where p.player_id = ps.player_id
	group by ps.player_id
	order by group_id, score desc, player_id
	-- limit 1 -- by default, groupby will pick the first one i.e. max score player here
) top_scores
group by group_id;

+----------+-----------+
| group_id | player_id |
+----------+-----------+
|        1 |        45 |
|        2 |        50 |
|        3 |        20 |
+----------+-----------+
3 rows in set (0.02 sec)

*************************************question 51 ***********************************

CREATE TABLE world(name VARCHAR(25) PRIMARY KEY, continent VARCHAR(25), area INT, population INT, gdp BIGINT);

INSERT INTO world VALUES('Afghanistan','Asia',652230,25500100,20343000000),
						('Albania','Europe',28748,2831741,12960000000),
						('Aleria','Africa',2381741,37100000,188681000000),
						('Andorra','Europe',468,78115,3712000000),
						('Angola','Africa',1246700,20609294,100990000000);
						
	mysql> select * from world;
+-------------+-----------+---------+------------+--------------+
| name        | continent | area    | population | gdp          |
+-------------+-----------+---------+------------+--------------+
| Afghanistan | Asia      |  652230 |   25500100 |  20343000000 |
| Albania     | Europe    |   28748 |    2831741 |  12960000000 |
| Aleria      | Africa    | 2381741 |   37100000 | 188681000000 |
| Andorra     | Europe    |     468 |      78115 |   3712000000 |
| Angola      | Africa    | 1246700 |   20609294 | 100990000000 |
+-------------+-----------+---------+------------+--------------+
5 rows in set (0.00 sec)


SELECT 
        name, 
        population, 
        area 
FROM 
        world 
WHERE 
        area > 3000000 
        OR 
        population > 25000000;


+-------------+------------+---------+
| name        | population | area    |
+-------------+------------+---------+
| Afghanistan |   25500100 |  652230 |
| Aleria      |   37100000 | 2381741 |
+-------------+------------+---------+
2 rows in set (0.00 sec)


**************************************************** question 52 *********************************************
CREATE TABLE customer(id INT PRIMARY KEY, name VARCHAR(11), referee_id INT);

INSERT INTO customer VALUES(1,'will',NULL),
							(2,'Jane',NULL),
							(3,'Alex',2),
							(4,'Bill',NULL),
							(5,'Zack',1),
							(6,'Mark',2);
mysql> desc customer;
+------------+-------------+------+-----+---------+-------+
| Field      | Type        | Null | Key | Default | Extra |
+------------+-------------+------+-----+---------+-------+
| id         | int(11)     | NO   | PRI | NULL    |       |
| name       | varchar(11) | YES  |     | NULL    |       |
| referee_id | int(11)     | YES  |     | NULL    |       |
+------------+-------------+------+-----+---------+-------+
3 rows in set (0.02 sec)

mysql> select * from customer;
+----+------+------------+
| id | name | referee_id |
+----+------+------------+
|  1 | will |       NULL |
|  2 | Jane |       NULL |
|  3 | Alex |          2 |
|  4 | Bill |       NULL |
|  5 | Zack |          1 |
|  6 | Mark |          2 |
+----+------+------------+
6 rows in set (0.00 sec)


SELECT 
        name 
FROM 
        customer 
WHERE 
        referee_id <> 2
        OR
        referee_id IS NULL;



+------+
| name |
+------+
| will |
| Jane |
| Bill |
| Zack |
+------+
4 rows in set (0.00 sec)


*************************** question 53 *************

CREATE TABLE customers(id INT PRIMARY Key, name VARCHAR(11));

CREATE TABLE orders(id INT PRIMARY KEY, Customer_id int, FOREIGN KEY(customer_id) REFERENCES customers(id));

mysql> desc customers;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int(11)     | NO   | PRI | NULL    |       |
| name  | varchar(11) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
2 rows in set (0.01 sec)

mysql> desc orders;
+-------------+---------+------+-----+---------+-------+
| Field       | Type    | Null | Key | Default | Extra |
+-------------+---------+------+-----+---------+-------+
| id          | int(11) | NO   | PRI | NULL    |       |
| Customer_id | int(11) | YES  | MUL | NULL    |       |
+-------------+---------+------+-----+---------+-------+
2 rows in set (0.01 sec)

INSERT INTO customers VALUES(1,'Joe'),
						(2,'Henry'),
						(3,'Sam'),
						(4,'Max');

INSERT INTO ORDERS VALUES(1,3),
							(2,1);
							


SELECT 
        name AS customers
FROM 
        customers
WHERE 
        id NOT IN (
					SELECT 
							customer_id 
					FROM 
							orders
					);
				
				
				
+-----------+
| customers |
+-----------+
| Henry     |
| Max       |
+-----------+
2 rows in set (0.01 sec)


************************* QUESTION 54 **************************

CREATE TABLE employee(employee_id int PRIMARY KEY, team_id int);

INSERT INTO employee VALUES(1,8),
							(2,8),
							(3,8),
							(4,7),
							(5,9),
							(6,9);
							
mysql> desc employee;
+-------------+---------+------+-----+---------+-------+
| Field       | Type    | Null | Key | Default | Extra |
+-------------+---------+------+-----+---------+-------+
| employee_id | int(11) | NO   | PRI | NULL    |       |
| team_id     | int(11) | YES  |     | NULL    |       |
+-------------+---------+------+-----+---------+-------+
2 rows in set (0.01 sec)


select e1.employee_id, count(*) as team_size
    from Employee e1 left join Employee e2
    on e1.team_id = e2.team_id
    group by e1.employee_id;
	
+-------------+-----------+
| employee_id | team_size |
+-------------+-----------+
|           1 |         3 |
|           2 |         3 |
|           3 |         3 |
|           4 |         1 |
|           5 |         2 |
|           6 |         2 |
+-------------+-----------+
6 rows in set (0.00 sec)


************************** question 55 *******************************

CREATE TABLE person(id INT PRIMARY KEY, name VARCHAR(11), phone_number varchar(15));

CREATE TABLE country(name varchar(20), country_code varchar(20) PRIMARY KEY);

CREATE TABLE calls(caller_id INT , callee_id INT, duration INT);

mysql> desc person;
+--------------+-------------+------+-----+---------+-------+
| Field        | Type        | Null | Key | Default | Extra |
+--------------+-------------+------+-----+---------+-------+
| id           | int(11)     | NO   | PRI | NULL    |       |
| name         | varchar(11) | YES  |     | NULL    |       |
| phone_number | varchar(15) | YES  |     | NULL    |       |
+--------------+-------------+------+-----+---------+-------+
3 rows in set (0.02 sec)

mysql> desc country;
+--------------+-------------+------+-----+---------+-------+
| Field        | Type        | Null | Key | Default | Extra |
+--------------+-------------+------+-----+---------+-------+
| name         | varchar(20) | YES  |     | NULL    |       |
| country_code | varchar(20) | NO   | PRI | NULL    |       |
+--------------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec)

mysql> desc calls;
+-----------+---------+------+-----+---------+-------+
| Field     | Type    | Null | Key | Default | Extra |
+-----------+---------+------+-----+---------+-------+
| caller_id | int(11) | YES  |     | NULL    |       |
| callee_id | int(11) | YES  |     | NULL    |       |
| duration  | int(11) | YES  |     | NULL    |       |
+-----------+---------+------+-----+---------+-----

INSERT INTO person VALUES 
        (3,'JONATHON','051-1234567'),
        (21,'ELVIS','051-7654321'),
        (1,'MONCEF','212-1234567'),
        (2,'MAROUA','212-6523651'),
        (7,'MEIR','972-1234567'),
        (9,'RACHEL','972-0011100');
		
		
INSERT INTO calls VALUES 
        (1,9,33),
        (1,2,59),
        (3,12,102),
        (3,12,330),
        (12,3,5),
        (7,9,13),
        (7,1,3),
        (9,7,1),
        (1,7,7),
        (2,9,4);
		
		
INSERT INTO country VALUES 
        ('PERU','51'),
        ('ISRAEL','972'),
        ('MOROCCO','212'),
        ('GERMANY','49'),
        ('ETHIOPIA','251');
	
SELECT 
		name AS country
FROM 	(
			SELECT 
					c.name, 
					SUM(ca.duration) AS call_duration, 
					COUNT(c.country_code) AS number_of_calls
			FROM (
					SELECT 
							id, 
							name,
							CASE
							WHEN LEFT(SUBSTR(phone_number, 1,3),1) = '0' THEN RIGHT(SUBSTR(phone_number, 1,3), (LENGTH(SUBSTR(phone_number, 1,3))-1)) 
							ELSE SUBSTR(phone_number, 1,3) END AS country_code 
					FROM 
							person
				 ) temp_person
			JOIN 
					country c
			ON 
					temp_person.country_code = c.country_code
			JOIN 
					calls ca
			ON 
					temp_person.id = caller_id
			GROUP BY 
					c.name

UNION ALL

SELECT 
		c.name,
        SUM(ca.duration) AS call_duration, 
        COUNT(c.country_code) AS number_of_calls
FROM 	(
			SELECT 
					id, 
					name,
					CASE
						WHEN LEFT(SUBSTR(phone_number, 1,3),1) = '0' THEN RIGHT(SUBSTR(phone_number, 1,3), (length(SUBSTR(phone_number, 1,3))-1)) 
						ELSE SUBSTR(phone_number, 1,3) END AS country_code 
			FROM 
					person
		) 	temp_person
JOIN 
		country c
ON 
		temp_person.country_code = c.country_code
JOIN 
		calls ca
ON 
		temp_person.id = ca.callee_id
GROUP BY 
		c.name 
        
		) temp
GROUP BY 
		name 
HAVING 
		SUM(call_duration)/SUM(number_of_calls) >  (SELECT AVG(duration) FROM calls);


+---------+
| country |
+---------+
| PERU    |
+---------+
1 row in set (0.02 sec)


**************************** question 56  ********************************using oracle database

CREATE TABLE activity(
        player_id INT,
        device_id INT,
        event_date DATE,
        games_played INT,
        CONSTRAINT prime_key PRIMARY KEY(player_id, event_date)
	);
	
 
INSERT INTO activity VALUES(1,2,'01-march-2016',5);
INSERT INTO activity VALUES(1,2,'02-may-2016',6);
INSERT INTO activity VALUES(2,3,'25-June-2017',1);
INSERT INTO activity VALUES(3,1,'02-March-2016',0);
INSERT INTO activity VALUES(3,4,'03-July-2018',5);
		

SQL> select * from activity;

 PLAYER_ID  DEVICE_ID EVENT_DAT GAMES_PLAYED
---------- ---------- --------- ------------
         1          2 01-MAR-16            5
         1          2 02-MAY-16            6
         2          3 25-JUN-17            1
         3          1 02-MAR-16            0
         3          4 03-JUL-18            5
		 
		 
		 SELECT 
        player_id,
        device_id 
FROM 
        (
            SELECT 
                    player_id, 
                    device_id, 
                    event_date, 
                    ROW_number() OVER(PARTITION BY player_id ORDER BY event_date) ranking 
            FROM 
                    activity
        ) temp_activity
WHERE 
        ranking = 1;
		 
		 
		 
		 

 PLAYER_ID  DEVICE_ID
---------- ----------
         1          2
         2          3
         3          1
		 
************************** question 57 *************************************
		 
		 
mysql> CREATE TABLE orders(
    ->         order_number INT,
    ->         customer_number INT,
    ->         CONSTRAINT prime_key PRIMARY KEY(order_number)
    ->     );
Query OK, 0 rows affected (0.01 sec)


mysql> INSERT INTO orders VALUES
    ->         (1,1),
    ->         (2,2),
    ->         (3,3),
    ->         (4,3);
Query OK, 4 rows affected (0.01 sec)
Records: 4  Duplicates: 0  Warnings: 0



mysql> SELECT
    ->     customer_number
    -> FROM Orders
    -> GROUP BY 1
    -> ORDER BY COUNT(*) DESC
    -> LIMIT 1;
+-----------------+
| customer_number |
+-----------------+
|               3 |
+-----------------+
1 row in set (0.02 sec)


****************************** question 58 ****************************

CREATE TABLE cinema(
        seat_id INT AUTO_INCREMENT,
        free BOOLEAN,
        CONSTRAINT prime_key PRIMARY KEY(seat_id)
    );



INSERT INTO cinema VALUES(1,1),
						(2,0),
						(3,1),
						(4,1),
						(5,1);
						

SELECT 
        DISTINCT c1.seat_id 
FROM 
        cinema c1
INNER JOIN 
        cinema c2
ON 
        ABS(c1.seat_id - c2.seat_id) = 1
        AND 
        (c1.free = 1 AND c2.free = 1)
ORDER BY 
        c1.seat_id;
		


+---------+
| seat_id |
+---------+
|       3 |
|       4 |
|       5 |
+---------+
3 rows in set (0.01 sec)


**************************** question 59 **************************

CREATE TABLE SalesPerson(sales_id INT PRIMARY KEY, Name VARCHAR(11), salary INT, commission_rate INT, hire_date DATE);


INSERT INTO salesPerson VALUES(1,'JOHN',100000,6,'2006-1-4');
INSERT INTO salesPerson VALUES(2,'AMY',12000,5,'2010-1-5');
INSERT INTO salesPerson VALUES(3,'MARK',65000,12,'2008-25-12');
INSERT INTO salesPerson VALUES(4,'PAM',25000,25,'2005-1-1');
INSERT INTO salesPerson VALUES(5,'ALEX',5000,10,'2007-3-2');



CREATE TABLE Company(com_id INT PRIMARY KEY, name VARCHAR(11), city VARCHAR(11));

INSERT INTO company VALUES
        (1,'RED','BOSTON'),
        (2,'ORANGE','NEW YORK'),
        (3,'YELLOW','BOSTON'),
        (4,'GREEN','AUSTIN');

CREATE TABLE orders(order_id INT PRIMARY KEY, order_date DATE, com_id INT, sales_id INT, amount INT, FOREIGN KEY(com_id) REFERENCES company(com_id), FOREIGN key(sales_id) REFERENCES SalesPerson(sales_id));

INSERT INTO orders VALUES
        (1,'1/1/2014',3,4,10000),
        (2,'2/1/2014',4,5,5000),
        (3,'3/1/2014',1,1,50000),
        (4,'4/1/2014',1,4,25000);


mysql> desc salesPerson;
+-----------------+-------------+------+-----+---------+-------+
| Field           | Type        | Null | Key | Default | Extra |
+-----------------+-------------+------+-----+---------+-------+
| sales_id        | int(11)     | NO   | PRI | NULL    |       |
| Name            | varchar(11) | YES  |     | NULL    |       |
| salary          | int(11)     | YES  |     | NULL    |       |
| commission_rate | int(11)     | YES  |     | NULL    |       |
| hire_date       | date        | YES  |     | NULL    |       |
+-----------------+-------------+------+-----+---------+-------+
5 rows in set (0.02 sec)

mysql> desc company;
+--------+-------------+------+-----+---------+-------+
| Field  | Type        | Null | Key | Default | Extra |
+--------+-------------+------+-----+---------+-------+
| com_id | int(11)     | NO   | PRI | NULL    |       |
| name   | varchar(11) | YES  |     | NULL    |       |
| city   | varchar(11) | YES  |     | NULL    |       |
+--------+-------------+------+-----+---------+-------+
3 rows in set (0.02 sec)

mysql> desc orders;
+------------+---------+------+-----+---------+-------+
| Field      | Type    | Null | Key | Default | Extra |
+------------+---------+------+-----+---------+-------+
| order_id   | int(11) | NO   | PRI | NULL    |       |
| order_date | date    | YES  |     | NULL    |       |
| com_id     | int(11) | YES  | MUL | NULL    |       |
| sales_id   | int(11) | YES  | MUL | NULL    |       |
| amount     | int(11) | YES  |     | NULL    |       |
+------------+---------+------+-----+---------+-------+
5 rows in set (0.02 sec)





SELECT 
        name 
FROM 
        salesPerson
WHERE 
        sales_id NOT IN (
                            SELECT 
                                    o.sales_id
                            FROM 
                                    orders o
                            INNER JOIN 
                                    company c 
                            ON 
                                    c.com_id = o.com_id
                            WHERE 
                                    c.name = 'RED'
                        );


******************************* question 60 ***************************

CREATE TABLE Triangle(x INT, y INT, z INT);


Alter TABLE Triangle ADD PRIMARY KEY(X,Y,Z);

INSERT INTO Triangle VALUES(13,15,30),
						 (10,20,15);




mysql> desc Triangle;
+-------+---------+------+-----+---------+-------+
| Field | Type    | Null | Key | Default | Extra |
+-------+---------+------+-----+---------+-------+
| x     | int(11) | NO   | PRI | 0       |       |
| y     | int(11) | NO   | PRI | 0       |       |
| z     | int(11) | NO   | PRI | 0       |       |
+-------+---------+------+-----+---------+-------+
3 rows in set (0.02 sec)


SELECT 
        x,
        y,
        z, 
        IF(x+y>z AND x+z>y AND y+z>x, 'YES','NO') AS is_triangle
FROM 
        triangle;


+----+----+----+-------------+
| x  | y  | z  | is_triangle |
+----+----+----+-------------+
| 10 | 20 | 15 | YES         |
| 13 | 15 | 30 | NO          |
+----+----+----+-------------+
2 rows in set (0.01 sec)

************************* question 61 ****************************

CREATE TABLE point(x INT PRIMARY KEY);

INSERT INTO point VALUES(-1),(0),(2);


SELECT 
        MIN(ABS(c1.x - c2.x)) AS shortest_distance
FROM 
        point c1
INNER JOIN 
        point c2
WHERE 
        c1.x!=c2.x;
		
		
		
+-------------------+
| shortest_distance |
+-------------------+
|                 1 |
+-------------------+
1 row in set (0.00 sec)




***************** question 62 ******************************

CREATE TABLE actor_director(
        actor_id INT,
        director_id INT,
        timestamp INT,
        CONSTRAINT prime_key PRIMARY KEY(timestamp)
    );
	
 
INSERT INTO actor_director VALUES(1,1,0),
								(1,1,1),
								(1,1,2),
								(1,2,3),
								(1,2,4),
								(2,1,5),
								(2,1,6);
								

select actor_id, director_id from Actor_Director
    group by actor_id, director_id
    having count(actor_id) >= 3;
	
+----------+-------------+
| actor_id | director_id |
+----------+-------------+
|        1 |           1 |
+----------+-------------+
1 row in set (0.01 sec)


********************** question 63 *********************************

CREATE TABLE sales(
        sale_id INT,
        product_id INT,
        year INT,
        Quantity INT,
        price INT,
        CONSTRAINT prime_key PRIMARY KEY(sale_id, year),
		FOREIGN KEY(product_id) REFERENCES product(product_id)
    );
	
 
INSERT INTO sales VALUES(1,100,2008,10,5000),
						(2,100,2009,12,5000),
						(7,200,2011,15,9000);


	mysql> desc sales;
+------------+---------+------+-----+---------+-------+
| Field      | Type    | Null | Key | Default | Extra |
+------------+---------+------+-----+---------+-------+
| sale_id    | int(11) | NO   | PRI | 0       |       |
| product_id | int(11) | YES  | MUL | NULL    |       |
| year       | int(11) | NO   | PRI | 0       |       |
| Quantity   | int(11) | YES  |     | NULL    |       |
| price      | int(11) | YES  |     | NULL    |       |
+------------+---------+------+-----+---------+-------+
5 rows in set (0.01 sec)
	
	
CREATE TABLE product(
        product_id INT,
        product_name VARCHAR(20),
        CONSTRAINT prime_key PRIMARY KEY(product_id)
    );

INSERT INTO product VALUES(100,'NOKIA'),
							(200,'APPLE'),
							(300,'SAMSUNG');

mysql> desc product;
+--------------+-------------+------+-----+---------+-------+
| Field        | Type        | Null | Key | Default | Extra |
+--------------+-------------+------+-----+---------+-------+
| product_id   | int(11)     | NO   | PRI | 0       |       |
| product_name | varchar(20) | YES  |     | NULL    |       |
+--------------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec)




SELECT 
        p.product_name,
        s.year,
        s.price
FROM 
        sales s
INNER JOIN 
        product p
ON 
        p.product_id = s.product_id;
		
		
		
+--------------+------+-------+
| product_name | year | price |
+--------------+------+-------+
| NOKIA        | 2008 |  5000 |
| NOKIA        | 2009 |  5000 |
| APPLE        | 2011 |  9000 |
+--------------+------+-------+
3 rows in set (0.00 sec)


********************** question 64 ********************

CREATE TABLE project(
        project_id INT,
        employee_id INT,
        CONSTRAINT prime_key PRIMARY KEY(project_id, employee_id),
		FOREIGN KEY(employee_id) REFERENCES employee(employee_id)
    );
	
 
INSERT INTO project VALUES(1,1),
							(1,2),
							(1,3),
							(2,1),
							(2,4);
mysql> desc project;
+-------------+---------+------+-----+---------+-------+
| Field       | Type    | Null | Key | Default | Extra |
+-------------+---------+------+-----+---------+-------+
| project_id  | int(11) | NO   | PRI | 0       |       |
| employee_id | int(11) | NO   | PRI | 0       |       |
+-------------+---------+------+-----+---------+-------+
2 rows in set (0.00 sec)




CREATE TABLE employee(
        employee_id INT,
        name VARCHAR(20),
        experience_years INT,
        CONSTRAINT prime_key PRIMARY KEY(employee_id)
    );
	
	
	

INSERT INTO employee VALUES(1,'KHALED',3),
							(2,'ALI',2),
							(3,'JOHN',1),
							(4,'DOE',2);
							
mysql> desc employee;
+------------------+-------------+------+-----+---------+-------+
| Field            | Type        | Null | Key | Default | Extra |
+------------------+-------------+------+-----+---------+-------+
| employee_id      | int(11)     | NO   | PRI | 0       |       |
| name             | varchar(20) | YES  |     | NULL    |       |
| experience_years | int(11)     | YES  |     | NULL    |       |
+------------------+-------------+------+-----+---------+-------+
3 rows in set (0.02 sec)



SELECT 
        p.project_id, 
        ROUND(AVG(experience_years), 2) AS average_years
FROM 
        employee e
INNER JOIN 
        project p
ON 
        p.employee_id = e.employee_id
GROUP BY 
        project_id;
		

+------------+---------------+
| project_id | average_years |
+------------+---------------+
|          1 |          2.00 |
|          2 |          2.50 |
+------------+---------------+
2 rows in set (0.02 sec)


********************** question 65 ***********************

CREATE TABLE product(product_id INT PRIMARY KEY, product_name VARCHAR(21), unit_price INT);

 
INSERT INTO product VALUES(1,'S8',1000),
							(2,'G4',800),
							(3,'Iphone',1400);
		
		

CREATE TABLE sales(seller_id INT PRIMARY KEY, product_id INT, buyer_id INT, sale_date DATE, quantity INT, price INT, FOREIGN KEY(product_id) REFERENCES product(product_id));

 
INSERT INTO sales VALUES(1,1,1,'2019-01-21',2,2000),
INSERT INTO sales VALUES(1,2,2,'2019-01-21',1,800),
INSERT INTO sales VALUES(2,2,3,'2019-01-21',1,800),
INSERT INTO sales VALUES(3,3,4,'2019-01-21',2,2800);

select seller_id from Sales group by seller_id
    having sum(price) = (
        select sum(price) from sales group by seller_id order by sum(price) desc limit 1
    );
	
	
+-----------+
| seller_id |
+-----------+
|         1 |
|         3 |
+-----------+
2 rows in set (0.01 sec)


********************* question 66 ***********************

CREATE TABLE product(product_id INT PRIMARY KEY, product_name VARCHAR(21), unit_price INT);

INSERT INTO product VALUES(1,'S8',1000),
							(2,'G4',800),
							(3,'Iphone',1400);
		
CREATE TABLE sales(seller_id INT PRIMARY KEY, product_id INT, buyer_id INT, sale_date DATE, quantity INT, price INT, FOREIGN KEY(product_id) REFERENCES product(product_id));

 
INSERT INTO sales VALUES(1,1,1,'2019-01-21',2,2000),
INSERT INTO sales VALUES(1,2,2,'2019-01-21',1,800),
INSERT INTO sales VALUES(2,2,3,'2019-01-21',1,800),
INSERT INTO sales VALUES(3,3,4,'2019-01-21',2,2800);

select distinct s.buyer_id
from Product p
join Sales s
on p.product_id=s.product_id
group by buyer_id
having sum(p.product_name='S8') > 0 and sum(p.product_name = 'iPhone') = 0;


+----------+
| buyer_id |
+----------+
|        1 |
+----------+
1 row in set (0.02 sec)



************************* question 67 ******************************

CREATE TABLE customer(
		customer_id INT,
		name VARCHAR(20),
		visited_on DATE,
		amount INT,
		CONSTRAINT PRIMARY_KEY PRIMARY KEY(customer_id,visited_on)
	);
	
INSERT INTO customer VALUES(1,'JOHN','01-january-2019',100);
INSERT INTO customer VALUES(2,'DANIEL','02-january-2019',110);
INSERT INTO customer VALUES(3,'JADE','03-january-2019',120);
INSERT INTO customer VALUES(4,'KHALED','04-january-2019',13);
INSERT INTO customer VALUES(5,'WINSTON','05-january-2019',110);
INSERT INTO customer VALUES(6,'ELVIS','06-january-2019',140);
INSERT INTO customer VALUES(7,'ANNA','07-january-2019',150);
INSERT INTO customer VALUES(8,'MARIA','08-january-2019',80);
INSERT INTO customer VALUES(9,'JAZE','09-january-2019',110);
INSERT INTO customer VALUES(1,'JOHN','10-january-2019',130);
INSERT INTO customer VALUES(3,'JADE','10-january-2019',150);


WITH temp_customer AS (
						SELECT 
								visited_on, 
								SUM(amount) AS amount
						FROM 
								customer
						GROUP BY 
								visited_on
					),

    temp_customer2 AS (
						SELECT 
								visited_on, 
								sum(amount) OVER(ORDER BY visited_on ROWS BETWEEN 6  PRECEDING AND CURRENT ROW) AS weekly_amount, 
								ROUND(AVG(amount) OVER(ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW), 2) AS average_amount,
								DENSE_RANK() OVER(ORDER BY visited_on) as ranking
						FROM 
								temp_customer
					)

SELECT 
        visited_on, 
        weekly_amount, 
        average_amount 
FROM 
        temp_customer2
WHERE 
        ranking > 6;


****************************** question 68 ***********************************

CREATE TABLE scores(
        player_name VARCHAR(20),
        gender VARCHAR(20),
        day DATE,
        score_points INT,
        CONSTRAINT prime_key PRIMARY KEY(gender,day)
    );
	
	

INSERT INTO scores VALUES('ARON','F','2020-01-01',17),
						('ALICE','F','2020-01-07',23),
						('BAJRANG','M','2020-01-07',7),
						('KHALI','M','2019-12-25',11),
						('SLAMAN','M','2019-12-30',13),
						('JOE','M','2019-12-31',3),
						('JOSE','M','2019-12-18',2),
						('PRIYA','F','2019-12-31',23),
						('PRIYANKA','F','2019-12-30',17);
						
						
select s.gender, s.day, (select sum(score_points) from Scores where gender = s.gender and day <= s.day) as total
    from Scores s
    group by gender, day
    order by gender, day;
	
+--------+------------+-------+
| gender | day        | total |
+--------+------------+-------+
| F      | 2019-12-30 |    17 |
| F      | 2019-12-31 |    40 |
| F      | 2020-01-01 |    57 |
| F      | 2020-01-07 |    80 |
| M      | 2019-12-18 |     2 |
| M      | 2019-12-25 |    13 |
| M      | 2019-12-30 |    26 |
| M      | 2019-12-31 |    29 |
| M      | 2020-01-07 |    36 |
+--------+------------+-------+
9 rows in set (0.02 sec)

******************************** question 69 ***********************using oracle database

CREATE TABLE logs(log_id INT PRIMARY KEY);
	


INSERT INTO logs VALUES(1);
INSERT INTO logs VALUES(2);
INSERT INTO logs VALUES(3);
INSERT INTO logs VALUES(7);
INSERT INTO logs VALUES(8);
INSERT INTO logs VALUES(10);

SELECT 
		MIN(log_id) AS start_id, 
		MAX(log_id) AS end_id 
FROM 
		(
            SELECT 
                    log_id, 
                    DENSE_RANK() OVER(ORDER BY log_id - RN) AS ranking
            FROM 
                    (
                        SELECT 
                                log_id,
                                ROW_number() OVER(ORDER BY log_id) AS RN
                        FROM 
                                logs
                    )	temp_log
        ) temp_log2
GROUP BY 
		ranking
ORDER BY
		start_id;
		
		
START_ID     END_ID
---------- ----------
         1          3
         7          8
        10         10

*******************************qustion 70 ************************************

CREATE TABLE students(student_id INT PRIMARY KEY,student_name VARCHAR(20));


CREATE TABLE subjects(subject_name VARCHAR(20) PRIMARY KEY);


CREATE TABLE examination(student_id INT,subject_name VARCHAR(20));

INSERT INTO students VALUES
        (1,'ALICE'),
        (2,'BOB'),
        (13,'JOHN'),
        (6,'ALEX');
		


INSERT INTO subjects VALUES
        ('MATHS'),
        ('PHYSICS'),
        ('PROGRAMMING');
		
		
		


INSERT INTO examination VALUES(1,'MATHS'),
								(1,'PHYSICS'),
								(1,'PROGRAMMING'),
								(2,'PROGRAMMING'),
								(1,'PHYSICS'),
								(1,'MATHS'),
								(13,'MATHS'),
								(13,'PROGRAMMING'),
								(13,'PHYSICS'),
								(2,'MATHS'),
								(1,'MATHS');
		
		
select
s.student_id, s.student_name, sub.subject_name, 
count(e.student_id) as attended_exams
from students s 
cross join subjects sub 
left join examination e on e.student_id = s.student_id 
     and e.subject_name = sub.subject_name
group by s.student_id, s.student_name, sub.subject_name
order by s.student_id, sub.subject_name;

+------------+--------------+--------------+----------------+
| student_id | student_name | subject_name | attended_exams |
+------------+--------------+--------------+----------------+
|          1 | ALICE        | MATHS        |              3 |
|          1 | ALICE        | PHYSICS      |              2 |
|          1 | ALICE        | PROGRAMMING  |              1 |
|          2 | BOB          | MATHS        |              1 |
|          2 | BOB          | PHYSICS      |              0 |
|          2 | BOB          | PROGRAMMING  |              1 |
|          6 | ALEX         | MATHS        |              0 |
|          6 | ALEX         | PHYSICS      |              0 |
|          6 | ALEX         | PROGRAMMING  |              0 |
|         13 | JOHN         | MATHS        |              1 |
|         13 | JOHN         | PHYSICS      |              1 |
|         13 | JOHN         | PROGRAMMING  |              1 |
+------------+--------------+--------------+----------------+
12 rows in set (0.01 sec)



********************* question 71 ********************************


CREATE TABLE employees(
        employee_id INT,
        employee_name VARCHAR(20),
        manager_id INT,
        CONSTRAINT prime_key PRIMARY KEY(employee_id)
    );
	
	
	
	
   
INSERT INTO employees VALUES(1,'BOSS',1),
							(3,'ALICE',3),
							(2,'BOB',1),
							(4,'DANIEL',2),
							(7,'LUIS',4),
							(8,'JHON',3),
							(9,'ANGELA',8),
							(77,'ROBERT',1);
							
							
--approach 1

select a.employee_id as EMPLOYEE_ID
from
    Employees as a
    left join
    Employees as b on a.manager_id = b.employee_id
    left join
    Employees as c on b.manager_id = c.employee_id
    left join
    Employees as d on c.manager_id = d.employee_id
where
    a.employee_id != 1
    and
    d.employee_id = 1;
	
--approach 2

select employee_id as EMPLOYEE_ID from Employees where manager_id in
(select employee_id from Employees WHERE manager_id in
(select employee_id from Employees where manager_id =1))
and employee_id !=1;

+-------------+
| EMPLOYEE_ID |
+-------------+
|           2 |
|           4 |
|           7 |
|          77 |
+-------------+
4 rows in set (0.01 sec)


********************* question 72 *************************

CREATE TABLE transactions(
        id INT,
        country VARCHAR(20),
        state ENUM ('APPROVED','DECLINED'),
        amount INT,
        trans_date DATE,
        CONSTRAINT prime_key PRIMARY KEY(id)
    );



INSERT INTO transactions VALUES (121,'US','APPROVED',1000,'2018-12-18'),
								(122,'US','DECLINED',2000,'2018-12-19'),
								(123,'US','APPROVED',2000,'2019-01-01'),
								(124,'DE','APPROVED',2000,'2019-01-07');
								

WITH temp_transactions AS (
							SELECT 
									concat(YEAR(trans_date), '-',MONTH(trans_date)) AS transaction_date, 
									country, 
									state,
									count(*) OVER (PARTITION BY concat(YEAR(trans_date), '-',MONTH(trans_date)), country) AS total_transactions,
									sum(amount) OVER (PARTITION BY concat(YEAR(trans_date), '-',MONTH(trans_date)), country) AS total_transactions_amount,
									sum(amount) OVER (PARTITION BY concat(YEAR(trans_date), '-',MONTH(trans_date)), country, state) AS amount
									
							FROM
									transactions
						)
        
SELECT 
        transaction_date,
		country,
        total_transactions,
        count(*) OVER(PARTITION BY transaction_date, country, state) AS approved_transactions,
        total_transactions_amount,
        amount AS approved_amount
        
FROM 
        temp_transactions
WHERE 
        state = 'Approved';


******************** question 73 **************************

CREATE TABLE actions(
        user_id INT,
        post_id INT,
        action_date DATE,
        action ENUM ('VIEW','LIKE','REACTION','COMMENT','REPORT','SHARE'),
        extra VARCHAR(20)
    );
	
	
CREATE TABLE removals(
        post_id INT,
        remove_date DATE,
        CONSTRAINT prime_key PRIMARY KEY(post_id)
    );


INSERT INTO actions VALUES(1,1,'2019-07-01','VIEW','NULL'),
						(1,1,'2019-07-01','LIKE','NULL'),
						(1,1,'2019-07-01','SHARE','NULL'),
						(2,2,'2019-07-04','VIEW','NULL'),
						(2,2,'2019-07-04','REPORT','SPAM'),
						(3,4,'2019-07-04','VIEW','NULL'),
						(3,4,'2019-07-04','REPORT','SPAM'),
						(4,3,'2019-07-02','VIEW','NULL'),
						(4,3,'2019-07-02','REPORT','SPAM'),
						(5,2,'2019-07-03','VIEW','NULL'),
						(5,2,'2019-07-03','REPORT','RACISM'),
						(5,5,'2019-07-03','VIEW','NULL'),
						(5,5,'2019-07-03','REPORT','RACISM');
		


INSERT INTO removals VALUES(2,'2019-07-20'),
							(3,'2019-07-18');
		

select round(avg(daily_count), 2) as average_daily_percent
from (select count(distinct b.post_id)/count(distinct a.post_id)*100 as daily_count
    from actions a
    left join removals b
    on a.post_id = b.post_id
    where extra = 'spam'
    group by action_date
    ) b;
	
+-----------------------+
| average_daily_percent |
+-----------------------+
|                 75.00 |
+-----------------------+
1 row in set (0.01 sec)


**************************** question 74 same as  Q.43 *******************

***************************** question 75 same as Q.43 *********************



*****************************question 76 **********************************using oracle database

CREATE TABLE salaries(company_id INT, employee_id INT, employee_name VARCHAR(20), salary INT);

ALTER TABLE salaries ADD PRIMARY KEY(company_id, employee_id);
    
INSERT INTO salaries VALUES(1,1,'TONY',2000);
INSERT INTO salaries VALUES(1,2,'PRONUB',21300);
INSERT INTO salaries VALUES(1,3,'TYRROX',10800);
INSERT INTO salaries VALUES(2,1,'PAM',300);
INSERT INTO salaries VALUES(2,7,'BASSEM',450);
INSERT INTO salaries VALUES(2,9,'HERMIONE',700);
INSERT INTO salaries VALUES(3,7,'BOCABEN',100);
INSERT INTO salaries VALUES(3,2,'OGNJEN',2200);
INSERT INTO salaries VALUES(3,13,'NYAN CAT',3300);
INSERT INTO salaries VALUES(3,15,'MORNING CAT',7777);
							

select company_id,
 employee_id,
 employee_name,
 round(case when max_salary < 1000 then salary 
 when max_salary between 1000 and 10000 then salary  (salary * .24)
 when max_salary > 10000 then salary  (salary * .49) else salary
 end) salary
from 
(select company_id,
 employee_id,
 employee_name,
 salary,
 max(salary) over (partition by company_id order by salary desc) max_salary
from salaries);


COMPANY_ID EMPLOYEE_ID EMPLOYEE_NAME            SALARY
---------- ----------- -------------------- ----------
         1           2 PRONUB                    10863
         1           3 TYRROX                     5508
         1           1 TONY                       1020
         2           9 HERMIONE                    700
         2           7 BASSEM                      450
         2           1 PAM                         300
         3          15 MORNING CAT                5911
         3          13 NYAN CAT                   2508
         3           2 OGNJEN                     1672
         3           7 BOCABEN                      76

10 rows selected.



********************* question 77 *******************************

CREATE TABLE sales(sale_date DATE,
		fruit VARCHAR(20),
		sold_num INT,
		CONSTRAINT prime_key PRIMARY KEY(sale_date, fruit)
	);



insert into sales VALUES('2020-05-01','apples',10),
						('2020-05-01','oranges',8),
						('2020-05-02','apples',15),
						('2020-05-02','oranges',15),
						('2020-05-03','apples',20),
						('2020-05-03','oranges',0),
						('2020-05-04','apples',15),
						('2020-05-04','oranges',16);
						
select date(sale_date) as sale_date,
       sum(case when fruit = 'apples' then sold_num
                when fruit = 'oranges' then -sold_num end) as diff
from Sales
group by 1
order by 1
;

    -> ;
+------------+------+
| sale_date  | diff |
+------------+------+
| 2020-05-01 |    2 |
| 2020-05-02 |    0 |
| 2020-05-03 |   20 |
| 2020-05-04 |   -1 |
+------------+------+
4 rows in set (0.02 sec)



************************* quesion 78 ****************************

CREATE TABLE variables(
        name VARCHAR(2),
        value INT,
        CONSTRAINT prime_key PRIMARY KEY(name)
    );
	


       
CREATE TABLE expressions(
        left_operand VARCHAR(2),
        operator ENUM('<','=','>'),
        right_operand VARCHAR(2),
        CONSTRAINT prime_key PRIMARY KEY(left_operand, operator, right_operand)
    );

SELECT 
		e.left_operand, 
        e.operator, 
        e.right_operand,
		CASE
			WHEN e.operator = '<' THEN IF(l.value < r.value, 'TRUE', 'FALSE')
			WHEN e.operator = '>' THEN IF(l.value > r.value, 'TRUE', 'FALSE')
            ELSE IF(l.value = r.value, 'TRUE', 'FALSE')
			END AS result
FROM 
		expressions e
JOIN 
		variables l
ON 		
		e.left_operand = l.name
JOIN 
		variables r
ON
        e.right_operand = r.name;

+--------------+----------+---------------+--------+
| left_operand | operator | right_operand | result |
+--------------+----------+---------------+--------+
| x            | =        | x             | TRUE   |
| y            | <        | x             | FALSE  |
| y            | >        | x             | TRUE   |
| x            | <        | y             | TRUE   |
| x            | =        | y             | FALSE  |
| x            | >        | y             | FALSE  |
+--------------+----------+---------------+--------+
6 rows in set (0.01 sec)


********************* question 79 ********************

CREATE TABLE movies(movie_id INT PRIMARY KEY, title VARCHAR(11));

INSERT INTO movies VALUES(1,'Avengers'),
							(2,'Frozen 2'),
							(3,'Joker');

CREATE TABLE users(user_id INT PRIMARY KEY, name VARCHAR(11));

INSERT INTO users VALUES(1,'Daniel'),
						(2,'Monica'),
						(3,'Maria'),
						(4,'James');
						
CREATE TABLE movieRating(movie_id INT,user_id INT,rating INT, created_at DATE);

INSERT INTO movieRating VALUES(1,1,3,'2020-01-12'),
								(1,2,4,'2020-02-11'),
								(1,3,2,'2020-02-12'),
								(1,4,1,'2020-01-01'),
								(2,1,5,'2020-02-17'),
								(2,2,2,'2020-02-01'),
								(2,3,2,'2020-03-01'),
								(3,1,3,'2020-02-22'),
								(3,2,4,'2020-02-25');
								


alter table movieRating ADD PRIMARY KEY(movie_id,user_id);


SELECT user_name AS results FROM
(
SELECT a.name AS user_name, COUNT(*) AS counts FROM MovieRating AS b
    JOIN Users AS a
    on a.user_id = b.user_id
    GROUP BY b.user_id
    ORDER BY counts DESC, user_name ASC LIMIT 1
) first_query
UNION
SELECT movie_name AS results FROM
(
SELECT c.title AS movie_name, AVG(d.rating) AS rate FROM MovieRating AS d
    JOIN Movies AS c
    on c.movie_id = d.movie_id
    WHERE substr(d.created_at, 1, 7) = '2020-02'
    GROUP BY d.movie_id
    ORDER BY rate DESC, movie_name ASC LIMIT 1
) second_query;


   
+----------+
| results  |
+----------+
| Daniel   |
| Frozen 2 |
+----------+
2 rows in set (0.01 sec)


*********************** question 80 ***************************

create table if not exists Person
(
    id int,
    name VARCHAR(50),
    phone_number VARCHAR(50),
    constraint pk PRIMARY KEY (id)
);

insert into Person VALUES (3,'Jonathan','051-1234567'),(12,'Elvis','051-7654321'),(1,'Moncef','212-1234567'),(2,'Maroua','212-6523651'),(7,'Meir','972-1234567'),(9,'Rachel','972-0011100');


create table if not exists Country
(
    name VARCHAR(50),
    country_code VARCHAR(50),
    constraint pk PRIMARY KEY (country_code)
);

insert into Country values ('Peru',51),('Israel',972),('Morocco',212),('Germany',49),('Ethiopia',251);



create table if not exists Calls
(
    caller_id int,
    callee_id int,
    duration int
);

insert into Calls VALUES (1,9,33),(2,9,4),(1,2,59),(3,12,102),(3,12,330),(12,3,5),(7,9,13),(7,1,3),(9,7,1),(1,7,7);



SELECT
 co.name AS country
FROM
 person p
 JOIN
     country co
     ON SUBSTRING(phone_number,1,3) = country_code
 JOIN
     calls c
     ON p.id IN (c.caller_id, c.callee_id)
GROUP BY
 co.name
HAVING
 AVG(duration) > (SELECT AVG(duration) FROM calls);
 
 +----------+
-- | country  |
-- +----------+
-- | Peru     |
-- +----------+

******************** Question 81 **************************

create table if not exists STUDENTS
(
    id int,
    name VARCHAR(50),
    marks int
);

insert into STUDENTS VALUES (1,'Ashley',81),(2,'Samantha',75),(4,'Julia',76),(3,'Belvet',84);



SELECT NAME FROM STUDENTS WHERE MARKS > 75 ORDER BY RIGHT(NAME,3), ID ASC;

+--------+
| NAME   |
+--------+
| Ashley |
| Julia  |
| Belvet |
+--------+
3 rows in set (0.00 sec)


******************* question 82 *********************

 create table if not exists Employee
(
    employee_id int,
    name VARCHAR(50),
    months int,
    salary int
);

insert into Employee VALUES (12228,'Rose',15,1968),(33645,'Angela',1,3443),(45692,'Frank',17,1608),(56118,'Patrick',7,1345),(59725,'Lisa',11,2330),(74197,'Kimberly',16,4372),(78454,'Bonnie',8,1771),(83565,'Michael',6,2017),(98607,'Todd',5,3396),(99989,'Joe',9,3573);


mysql> SELECT name FROM Employee ORDER BY name;
+----------+
| name     |
+----------+
| Angela   |
| Bonnie   |
| Frank    |
| Joe      |
| Kimberly |
| Lisa     |
| Michael  |
| Patrick  |
| Rose     |
| Todd     |
+----------+
10 rows in set (0.00 sec)


******************* question 83 **********************

CREATE TABLE employee(employee_id INT, name VARCHAR(11), months INT, salary INT);


INSERT INTO employee VALUES(12228,'Rose',15,1568),
							(33645,'Angela',1,3443),
							(45692,'Frank',17,1608),
							(56118,'Patrick',7,1345),
							(59725,'Lisa',11,2330),
							(74197,'Kimberly',16,4372),
							(78454,'Bonnie',8,1771),
							(83565,'Michael',6,2017),
							(98607,'Todd',5,3396),
							(99989,'Joe',9,3573);

SELECT name FROM Employee WHERE salary > 2000 AND months < 10 ORDER BY employee_id;						

+---------+
| name    |
+---------+
| Angela  |
| Michael |
| Todd    |
| Joe     |
+---------+
4 rows in set (0.00 sec)
						
						
************************ QUESTION 84 ********************

 create table if not exists TRIANGLES
(
    A int,
    B int,
    C int
);


insert into TRIANGLES VALUES (20,20,23),(20,20,20),(20,21,22),(13,14,30);


SELECT CASE
WHEN A + B <= C OR A + C <= B OR B + C <= A THEN 'Not A Triangle'
WHEN A = B AND B = C THEN 'Equilateral'
WHEN A = B OR B = C OR A = C THEN 'Isosceles'
ELSE 'Scalene'
END
FROM TRIANGLES;



END |
+------------------------------------------------------------------+
| Isosceles

                          |
| Equilateral

                          |
| Scalene

                          |
| Not A Triangle

                          |
+---------------------------------------------------------------------+



***************** QUESTION 85 ***************************

--user_transactions Table:
create table if not exists user_transactions
(
    transaction_id int,
    product_id int,
    spend decimal (5,2),
    transaction_date date
);

insert into user_transactions VALUES (1341,123424,1500.60,'2019-12-31 12:00:00'),
									(1423,123424,1000.20,'2020-12-31 12:00:00'),
									(1623,123424,1246.44,'2021-12-31 12:00:00'),
									(1322,123424,2145.32,'2022-12-31 12:00:00');
WITH temp_transactions AS (
							SELECT 
									product_id,
									transaction_date,
									spend AS curr_year_spend, 
									LAG(spend,1,0) OVER w AS prev_year_spend,
									IFNULL(spend - LAG(spend,1) OVER w, 0) AS prev_curr_spend_diff
							FROM 
									user_transactions
							WINDOW 
									w AS (PARTITION BY product_id ORDER BY EXTRACT(YEAR FROM transaction_date))
						)
 
SELECT 
        product_id,
        curr_year_spend, 
        ROUND(prev_year_spend, 2),
        IFNULL(ROUND((prev_curr_spend_diff * 100)/prev_year_spend,2),0) AS YOY 
FROM 
        temp_transactions;

--approach second_player

SELECT 
        product_id,
        YEAR(STR_TO_date(transaction_date, '%m/%d/%Y')) AS YEAR_id,
        spend AS curr_year_spend, 
        ROUND(LAG(spend,1,0) OVER w ,2) AS prev_year_spend,
        ROUND((spend - LAG(spend,1) OVER w ) * 100 /
                    LAG(spend,1) OVER w, 2)  AS YOY
FROM 
        user_transactions
WINDOW 
		w AS (PARTITION BY product_id ORDER BY EXTRACT(YEAR FROM transaction_date));





***************** question 86 ****************************
CREATE TABLE inventory(item_id INT, item_type VARCHAR(21), item_category VARCHAR(21), square_footage INT);

INSERT INTO inventory VALUES(1374,'prime_eligible', 'mini refrigerator',68.00),
							(4245,'not_prime','standing lamp',26.40),
							(2452,'prime_eligible','television',85.00),
							(3255,'not_prime','side table',22.60),
							(1672,'prime_eligible','laptop',8.50);

WITH temp_inventory AS (
						SELECT 
								item_type, 
								SUM(square_foot) AS square_foot_per_category, 
								COUNT(*) AS count_of_items
						FROM 
								inventory
						GROUP BY 
								item_type
					),
                    
    temp_inventory2 AS (
						SELECT 
								(500000 - SUM(square_foot_per_category)*FLOOR(500000/SUM(square_foot_per_category))) AS area_left 
						FROM 
								temp_inventory 
						WHERE 
								item_type = 'PRIME_ELIGIBLE'
					),
                    
    temp_inventory3 AS (
						SELECT 
								item_type,
								CASE 
									WHEN item_type = 'PRIME_ELIGIBLE' 
										THEN FLOOR(500000/square_foot_per_category) * count_of_items
                                                
									WHEN item_type = 'NOT_PRIME' 
										THEN FLOOR((SELECT area_left FROM temp_inventory2) / square_foot_per_category) * count_of_items
                                        
									END AS item_count
						FROM 
								temp_inventory
					)
             
SELECT 
        item_type,
        item_count
 FROM 
        temp_inventory3;

***************** question 87 ***************************

CREATE TABLE user_actions(user_id INT,
event_id INT,
event_type VARCHAR(21), 
event_date datetime
);

INSERT INTO user_actions VALUES(445, 7765, 'sign-in', '2022-05-31 12:00:00'),
								(742, 6458, 'sign-in', '2022-06-03 12:00:00'),
								(445, 3634, 'like', '2022-06-05 12:00:00'),
								(742, 1374,'comment', '2022-06-05 12:00:00'),
								(648, 3124, 'like', '2022-06-18 12:00:00');
								
WITH temp_actions AS (
						SELECT 
								user_id,
								event_date,
								event_type,
								SUBSTR(event_date, 6, 2) - lag(SUBSTR(event_date, 6, 2)) OVER w AS difference
						FROM 
								user_actions
						WINDOW 
								w as (PARTITION BY user_id ORDER BY event_date)
				),

	temp_actions2 AS (
						SELECT 
								SUBSTR(event_date, 6, 2) AS months,
								COUNT(user_id) AS monthly_active_users
						FROM 	
								temp_actions
						WHERE 
								difference = 1 AND event_type IN ('LIKE', 'COMMENT', 'SIGN-IN')
						GROUP BY 
								months
				)
   
SELECT 
		months,
        monthly_active_users
FROM 
        temp_actions2;



******************** question 88 ***************************
CREATE TABLE search_frequency(searches INT,num_users INT);

INSERT INTO search_frequency(1, 2),
							(2, 2),
							(3, 3),
							(4, 1);

CREATE TABLE search_frequency(
        searches INT,
        num_users INT
    );


INSERT INTO search_frequency VALUES
        (1,2),
        (2,2),
        (3,3),
        (4,1);


 WITH temp_search_freq AS (
							SELECT 
									searches,
									num_users,
									ROW_NUMBER() OVER(ORDER BY searches) row_num,
									COUNT(*) OVER(ORDER BY searches ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) total_records
							FROM
									search_frequency
					),
        
    temp_search_freq2 as (
							SELECT 
									searches,
									num_users,
									CASE
							WHEN total_records % 2 <>  0 THEN (
														SELECT 
																DISTINCT ROUND(SUM(searches) OVER w /
																COUNT(*) OVER w,1)
														FROM 
																temp_search_freq 
														WHERE 
																row_num = ROUND((total_records + 1) / 2, 0)
														WINDOW 
																w AS (ORDER BY searches ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)
														
													)
													
							WHEN total_records % 2 = 0 THEN (
														SELECT 
																DISTINCT ROUND(SUM(searches) OVER w /
																COUNT(*) OVER w,1)
														FROM
																temp_search_freq 
														WHERE 
																row_num IN (total_records/2,(total_records/2)+1)
														WINDOW 
																w AS (ORDER BY searches ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)
												)
							END AS median
							FROM 
                        temp_search_freq
            )
            

SELECT 
        DISTINCT median 
FROM 
        temp_search_freq2;

						


********************* question 89 **********************88

CREATE TABLE advertiser(user_id VARCHAR(11),status VARCHAR(11));

INSERT INTO advertiser VALUES('bing', 'NEW'),
							('yahooo','NEW'),
							('alibaba','EXISTING');


CREATE TABLE daily_pay(user_id VARCHAR(11), paid decimal);

INSERT INTO daily_pay VALUES('yahoo',45.00),
							('target',13.00);
							
						

						

WITH joined_table AS (
SELECT a.user_id, a.status, d.paid
FROM advertiser a
LEFT JOIN daily_pay d
USING (user_id)
UNION ALL
SELECT d.user_id, a.status, d.paid
FROM advertiser a
RIGHT JOIN daily_pay d
USING (user_id)
WHERE a.user_id IS NULL)
SELECT user_id,
  CASE WHEN status IS NULL AND paid IS NOT NULL
  THEN 'NEW'
  WHEN status = 'NEW' AND paid IS NOT NULL
  THEN 'EXISTING'
  WHEN status = 'NEW' AND paid IS NULL
  THEN 'CHURN'
  WHEN status = 'EXISTING' AND paid IS NOT NULL
  THEN 'EXISTING'
  WHEN status = 'EXISTING' AND paid IS NULL
  THEN 'CHURN'
  WHEN status = 'CHURN' AND paid IS NOT NULL
  THEN 'RESURRECT'
  WHEN status = 'CHURN' AND paid IS NULL
  THEN 'CHURN'
  WHEN status = 'RESURRECT' AND paid IS NOT NULL
  THEN 'EXISTING'
  WHEN status = 'RESURRECT' AND paid IS NULL
  THEN 'CHURN'
END AS new_status
FROM joined_table
ORDER BY user_id;



*********************** question 90  **************************

CREATE TABLE server_utilization(
        server_id INT,
        session_status VARCHAR(20),
        status_time VARCHAR(25)
    );


INSERT INTO server_utilization VALUES(1,'start', '08/02/2022 10:00:00'),
									(1,	'stop',	'08/04/2022 10:00:00'),
									(2,	'stop',	'08/24/2022 10:00:00'),
									(2,	'start','08/17/2022 10:00:00');


SELECT 
		stop_time - start_time AS total_up_time
FROM
		(
			SELECT
					SUM(
						CASE
							WHEN session_status = 'start' then EXTRACT(DAY from STR_TO_DATE(status_time, '%m/%d/%y'))
							END
						) AS start_time,
					SUM(
						CASE
							WHEN session_status = 'stop' then EXTRACT(DAY from STR_TO_DATE(status_time, '%m/%d/%y'))
							END
						) AS stop_time
			FROM
					server_utilization
        ) temp_server_utilization;
		

+---------------+
| total_up_time |
+---------------+
|             9 |
+---------------+
1 row in set, 4 warnings (0.02 sec)


************************** question 91 ***********************

CREATE TABLE transactions(
        transaction_id INT,
        merchant_id INT,
        credit_card_id INT,
        amount INT,
        transaction_timestamp DATETIME
    );



INSERT INTO transactions VALUES(1,101,1,100,'2022-09-25 12:00:00');
INSERT INTO transactions VALUES(2,101,1,100,'2022-09-25 12:08:00');
INSERT INTO transactions VALUES(3,101,1,100,'2022-09-25 12:28:00');
INSERT INTO transactions VALUES(4,102,2,300,'2022-09-25 12:00:00');
INSERT INTO transactions VALUES(5,102,2,400,'2022-09-25 14:00:00');


WITH temp_transactions AS (
							SELECT 
									merchant_id, 
									credit_card_id, 
									amount, 
									transaction_timestamp,
									LAG(transaction_timestamp) OVER w AS prev_tran_timestamp,
									EXTRACT(EPOCH FROM LAG(transaction_timestamp) OVER w -  transaction_timestamp) AS difference
							FROM 
									transactions
							WINDOW
									w as (PARTITION BY credit_card_id ORDER BY  transaction_timestamp)
					)
 
 SELECT 
        COUNT(DISTINCT merchant_id) AS payment_count
FROM 
        temp_transactions
 WHERE 
        difference < 10;
		
		
********************* question 92  ***************************

CREATE TABLE orders(order_id INT,
					customer_id INT,
					trip_id INT,
					status VARCHAR(55),
					order_timestamp TIMESTAMP
				);
				


INSERT INTO orders VALUES(727424, 8472, 100463, 'completed successfully', '2022-05-06 09:12:00'),
					  
									
						(242513, 2341, 100482, 'completed  incorrectly', '2022-05-06 14:40:00'),
              

						(141367, 1314, 100362, 'completed incorrectly',  '2022-07-06 15:03:00'),

						(582193, 5421, 100657, 'never_received', '2022-07-07 15:22:00'),

						(253613, 1314, 100213, 'completed successfully', '2022-12-06 13:43:00');
REATE TABLE trips(
        dasher_id INT,
        trip_id INT,
        estimated_delivery_timestamp VARCHAR(25),
        actual_delivery_timestamp VARCHAR(25)
    );


INSERT INTO TRIPS VALUES 
        (101,100463,'2022-06-05 09:42:00','2022-06-05 09:38:00'),
        (102,100482,'2022-06-05 15:10:00','2022-06-05 15:46:00'),
        (101,100362,'2022-06-07 15:33:00','2022-06-07 16:45:00'),
        (102,100657,'2022-07-07 15:52:00',NULL),
        (103,100213,'2022-06-12 14:13:00','2022-06-12 14:10:00');


CREATE TABLE customers(
        customer_id INT,
        signup_timestamp VARCHAR(30)
    );


INSERT INTO customers VALUES    
        (8472,'2022-05-30 00:00:00'),
        (2341,'2022-06-01 00:00:00'),
        (1314,'2022-06-03 00:00:00'),
        (1435,'2022-06-05 00:00:00'),
        (5421,'2022-06-07 00:00:00');



SELECT 
        ROUND(
            SUM(
                CASE
                    WHEN status !='completed successfully'  THEN 1 ELSE 0
                    END 
                )*100.0/count(*),2)  AS bad_experience_pct
FROM 
        customers C
INNER JOIN 
        orders O 
ON 
        o.customer_id = c.customer_id
WHERE 
        o.order_timestamp < date_add(STR_TO_date(signup_timestamp, '%m/%d/%Y'), INTERVAL 14 DAY) 
        AND 
        MONTH(STR_TO_date(signup_timestamp, '%m/%d/%Y')) = 06 
        AND 
        YEAR(STR_TO_date(signup_timestamp, '%m/%d/%Y')) = 2022;





********************* question 93 ***************************

CREATE TABLE scores(player_name VARCHAR(21),
					gender VARCHAR(21), 
					day DATE, 
					score_points INT,
					CONSTRAINT prime_key PRIMARY KEY(gender,DAY)
);


INSERT INTO scores VALUES('Aron', 'F', '2020-01-01', 17),
						('Alice', 'F', '2020-01-07', 23),
						('Bajrang', 'M', '2020-01-07', 7),
						('Khali', 'M', '2019-12-25', 11),
						('Slaman', 'M', '2019-12-30', 13),
						('Joe', 'M', '2019-12-31', 3),
						('Jose','M', '2019-12-18', 2),
						('Priya', 'F', '2019-12-31', 23),
						('Priyanka', 'F', '2019-12-30', 17);
						

select s.gender, s.day, (select sum(score_points) from Scores where gender = s.gender and day <= s.day) as total
    from Scores s
    group by gender, day
    order by gender, day;
	
	
+--------+------------+-------+
| gender | day        | total |
+--------+------------+-------+
| F      | 2019-12-30 |    17 |
| F      | 2019-12-31 |    40 |Q
| F      | 2020-01-01 |    57 |
| F      | 2020-01-07 |    80 |
| M      | 2019-12-18 |     2 |
| M      | 2019-12-25 |    13 |
| M      | 2019-12-30 |    26 |
| M      | 2019-12-31 |    29 |
| M      | 2020-01-07 |    36 |
+--------+------------+-------+
9 rows in set (0.00 sec)


************************ question 94 **********************

CREATE TABLE person(id INT PRIMARY KEY,
name VARCHAR(21),
phone_number VARCHAR(21));


CREATE TABLE country(name VARCHAR(21),
					country_code VARCHAR(21) PRIMARY KEY
					);
					
					
CREATE TABLE calls(caller_id INT,
					callee_id INT,
					duration INT);


INSERT INTO person VALUES(3,'Jonathan', '051-1234567'),
						(12, 'Elvis', '051-7654321'),
						(1, 'Moncef', '212-1234567'),
						(92, 'Maroua', '212-6523651'),
						(7, 'Meir', '972-1234567'),
						(9, 'Rachel', '972-0011100');
						
INSERT INTO country VALUES('Peru', 51),
						('Israel', 972),
						('Morocco', 212),
						('Germany', 49),
						('Ethiopia', 251);
						
					

INSERT INTO calls VALUES(1, 9, 33),
						(2, 9, 4),
						(1, 2, 59),
						(3, 12 ,330),
						(12, 3, 5),
						(9, 7, 10),
						(1, 7, 7);


SELECT
 co.name AS country
FROM
 person p
 JOIN
     country co
     ON SUBSTRING(phone_number,1,3) = country_code
 JOIN
     calls c
     ON p.id IN (c.caller_id, c.callee_id)
GROUP BY
 co.name
HAVING
 AVG(duration) > (SELECT AVG(duration) FROM calls);



************************question 95 ************************

CREATE TABLE Numbers(num INT PRIMARY KEY,Frequency INT);


INSERT INTO numbers VALUES(0,7),
							(1,1),
							(2,3),
							(3,1);
							


WITH RECURSIVE num_frequency (num,frequency, i) AS 
					(
						SELECT  num,
								frequency,1
						FROM   
								numbers
						UNION ALL
						SELECT   num,
								frequency,
								i+1
						FROM    
								num_frequency
						WHERE   
								num_frequency.i < num_frequency.frequency
				),
        
	num_frequency2 AS (
						SELECT 
								num, 
								frequency, 
								row_number() OVER(ORDER BY num, frequency) AS row_num,
								COUNT(*) OVER(ORDER BY  num, frequency ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS total_records
						FROM    
								num_frequency
				)


SELECT	
		DISTINCT CASE
					WHEN total_records % 2 <>  0 THEN (
                                                SELECT 
                                                        DISTINCT ROUND(SUM(num) OVER w /
                                                        COUNT(*) OVER  w, 1)
						                        FROM 
                                                        num_frequency2 
                                                WHERE 
                                                        row_num = ROUND((total_records + 1) / 2, 0)
												WINDOW
														w as (ORDER BY  num, frequency ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING))
                        
                    WHEN total_records % 2 = 0 THEN (
                                                SELECT 
                                                        DISTINCT ROUND(SUM(num) OVER w /
                                                        COUNT(*) OVER w, 1)
						                        FROM 
                                                        num_frequency2 
                                                WHERE 
                                                        row_num IN (total_records/2,(total_records/2)+1)
												WINDOW
														w as (ORDER BY  num, frequency ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING))       
                    END AS median
FROM 
        num_frequency2;



*********************** Question 96 ***********************

CREATE TABLE salary(
        id INT,
        employee_id INT,
        amount INT,
        paydate DATE,
        CONSTRAINT prime_key PRIMARY KEY(id)
    );


CREATE TABLE employee(
        employee_id INT,
        department_id INT,
        CONSTRAINT prime_key PRIMARY KEY(employee_id)
    );


INSERT INTO salary VALUES
        (1,1,9000,'2017/03/31'),
        (2,2,6000,'2017/03/31'),
        (3,3,10000,'2017/03/31'),
        (4,1,7000,'2017/02/28'),
        (5,2,6000,'2017/02/28'),
        (6,3,8000,'2017/02/28');


INSERT INTO employee VALUES
        (1,1),
        (2,2),
        (3,2);
        




WITH temp_comparison AS (
						SELECT 
								s.employee_id, 
								e.department_id,
								s.amount, 
								s.paydate,
								avg(amount) OVER (PARTITION BY MONTH(paydate) ORDER BY month(paydate), employee_id 
													ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) company_avg_salary,
								avg(amount) OVER (PARTITION BY MONTH(paydate), department_id order by month(paydate) 
													ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) department_avg 
						FROM
								salary s
						INNER JOIN 
								employee e
						ON 
								e.employee_id = s.employee_id
            )
 
 SELECT 
        DISTINCT DATE_FORMAT(paydate, '%Y-%m') AS pay_month, 
        department_id,
        CASE
            WHEN company_avg_salary = department_avg THEN 'same'
            WHEN company_avg_salary > department_avg THEN 'lower'
            WHEN company_avg_salary < department_avg THEN 'higher'
            END AS comparison
 FROM 
        temp_comparison;
		


********************* question 97 ***********************************


CREATE TABLE activity(
        player_id INT,
        device_id INT,
        event_date DATE,
        games_played INT,
        CONSTRAINT prime_key PRIMARY KEY(player_id, event_date)
    );


INSERT INTO activity VALUES 
        (1,2,'2016-03-01',5),
        (1,2,'2016-03-02',6),
        (2,3,'2017-06-25',1),
        (3,1,'2016-03-01',0),
        (3,4,'2018-07-03',5);


SELECT 
        a.event_date AS install_date, 
        COUNT(a.player_id) AS installs, 
        ROUND(COUNT(b.player_id) / COUNT(a.player_id), 2) AS day1_retention
FROM
        (
            SELECT 
                    player_id, 
                    MIN(event_date) AS event_date
            FROM 
                    activity 
            GROUP BY 
                    player_id
		) a
LEFT JOIN 
        activity b
ON 
        a.player_id = b.player_id 
        AND 
        a.event_date + 1 = b.event_date
GROUP BY 
        a.event_date;
		
		

    ->         a.event_date;
+--------------+----------+----------------+
| install_date | installs | day1_retention |
+--------------+----------+----------------+
| 2016-03-01   |        2 |           0.50 |
| 2017-06-25   |        1 |           0.00 |
+--------------+----------+----------------+
2 rows in set (0.02 sec)


********************** question 98 ****************************

CREATE TABLE players(player_id INT PRIMARY KEY,
					group_id INT);
					
					
INSERT INTO players VALUES(15,1),
							(25,1),
							(30,1),
							(45,1),
							(10,2),
							(35,20),
							(50,2),
							(20,3),
							(40,3);

CREATE TABLE Matches(match_id INT PRIMARY KEY,
					first_player INT,
					second_player INT,
					first_score INT,
					second_score INT);

INSERT INTO matches VALUES (1,15, 45, 3, 0),
						(2,30, 25, 1, 2),
						(3, 30, 15, 2, 0),
						(4, 40,20, 5,2),
						(5, 35, 50, 1, 1);

select group_id, player_id from (
	select p.group_id, ps.player_id, sum(ps.score) as score
	from Players p,
	    (
            select first_player as player_id, first_score as score
            from Matches
            union all
            select second_player, second_score
            from Matches
	    ) ps
	where p.player_id = ps.player_id
	group by ps.player_id
	order by group_id, score desc, player_id
	-- limit 1 -- by default, groupby will pick the first one i.e. max score player here
) top_scores
group by group_id;
						

********************* question 99 ************************

CREATE TABLE student(student_id INT PRIMARY KEY,
					Student_name VARCHAR(21));
					
CREATE TABLE Exam(exam_id INT,
				student_id INT,
				score INT,
				CONSTRAINT prime_key PRIMARY KEY(exam_id,student_id));
				


INSERT INTO student VALUES(1, 'Daniel'),
							(2, 'Jade'),
							(3, 'Stella'),
							(4, 'Jonathan'),
							(5, 'Will');
							
INSERT INTO exam VALUES(10, 1, 70),
						(10, 2, 80),
						(10, 3, 90),
						(20, 1, 80),
						(30, 1, 70),
						(30, 3, 80),
						(30, 4 ,90),
						(40, 1, 60),
						(40, 2, 70),
						(40, 4, 80);
						
select student_id,student_name 
from student
where student_id in (select student_id from exam) and 
      student_id not in 
        (select student_id 
         from 
            (select student_id, 
                rank() over(partition by exam_id order by score asc) as asc_rank,
                rank() over(partition by exam_id order by score desc) as desc_rank 
             from exam) tab1
        where asc_rank=1 or desc_rank=1);


********************** QUESTION 100 SAME AS 99*****************************



